<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Comments</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        input, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§ª Test API Comments</h1>
        
        <div class="test-section">
            <h3>1. Test de connexion au serveur</h3>
            <button onclick="testConnection()">Tester la connexion</button>
            <div id="connection-result"></div>
        </div>

        <div class="test-section">
            <h3>2. Obtenir tous les commentaires</h3>
            <button onclick="getAllComments()">GET /api/Comments</button>
            <div id="get-comments-result"></div>
        </div>

        <div class="test-section">
            <h3>3. CrÃ©er un commentaire de test</h3>
            <input type="text" id="test-project-id" placeholder="ID du projet (ex: suivi-produit-ats)" value="suivi-produit-ats">
            <input type="text" id="test-author" placeholder="Auteur" value="Test User">
            <textarea id="test-comment" placeholder="Commentaire de test" rows="3">Ceci est un commentaire de test pour vÃ©rifier que l'API fonctionne correctement ! ðŸš€</textarea>
            <button onclick="createComment()">POST /api/Comments</button>
            <div id="create-comment-result"></div>
        </div>

        <div class="test-section">
            <h3>4. Obtenir un commentaire spÃ©cifique</h3>
            <input type="text" id="get-project-id" placeholder="ID du projet" value="suivi-produit-ats">
            <button onclick="getComment()">GET /api/Comments/{projectId}</button>
            <div id="get-comment-result"></div>
        </div>

        <div class="test-section">
            <h3>5. Statistiques des commentaires</h3>
            <button onclick="getStats()">GET /api/Comments/stats</button>
            <div id="stats-result"></div>
        </div>

        <div class="test-section">
            <h3>6. Tester avec le dashboard</h3>
            <p>Une fois que tous les tests passent, vous pouvez tester directement dans le dashboard :</p>
            <a href="dashboard-projects-NV.html" target="_blank" style="display: inline-block; padding: 10px 20px; background: #28a745; color: white; text-decoration: none; border-radius: 4px;">Ouvrir le Dashboard</a>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8088/api/Comments';
        
        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            element.className = isError ? 'error' : 'success';
        }

        async function testConnection() {
            try {
                const response = await fetch('http://localhost:8088/api/Comments');
                if (response.ok) {
                    showResult('connection-result', { status: 'OK', message: 'Serveur accessible' });
                } else {
                    showResult('connection-result', { status: 'ERROR', code: response.status }, true);
                }
            } catch (error) {
                showResult('connection-result', { status: 'ERROR', message: error.message }, true);
            }
        }

        async function getAllComments() {
            try {
                const response = await fetch(API_BASE);
                const data = await response.json();
                showResult('get-comments-result', data);
            } catch (error) {
                showResult('get-comments-result', { error: error.message }, true);
            }
        }

        async function createComment() {
            const projectId = document.getElementById('test-project-id').value;
            const author = document.getElementById('test-author').value;
            const comment = document.getElementById('test-comment').value;

            try {
                const response = await fetch(API_BASE, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        projectId: projectId,
                        author: author,
                        comment: comment
                    })
                });

                const data = await response.json();
                showResult('create-comment-result', data);
            } catch (error) {
                showResult('create-comment-result', { error: error.message }, true);
            }
        }

        async function getComment() {
            const projectId = document.getElementById('get-project-id').value;
            
            try {
                const response = await fetch(`${API_BASE}/${projectId}`);
                const data = await response.json();
                showResult('get-comment-result', data);
            } catch (error) {
                showResult('get-comment-result', { error: error.message }, true);
            }
        }

        async function getStats() {
            try {
                const response = await fetch(`${API_BASE}/stats`);
                const data = await response.json();
                showResult('stats-result', data);
            } catch (error) {
                showResult('stats-result', { error: error.message }, true);
            }
        }

        // Test automatique au chargement
        window.addEventListener('load', () => {
            setTimeout(testConnection, 1000);
        });
    </script>
</body>
</html>
