<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title data-i18n="app.title">Dashboard Projets 2025 ‚Äî Nathan</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ["Inter", "ui-sans-serif", "system-ui"] },
          colors: {
            ink: { 900: "#0b0f14", 800: "#0f141b", 700: "#131924", 600: "#1a2332" },
            brand: { 400: "#34d399", 500: "#10b981", 600: "#059669" }
          },
          boxShadow: { glass: "0 10px 30px -12px rgba(0,0,0,.5)" }
        }
      }
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="proxy-server.js"></script>
  <script src="assets/js/comments-component.js"></script>
    <style>
    html, body { background: #0b0f14; min-height: 100vh; }
    .card { backdrop-filter: blur(6px); background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03)); border: 1px solid rgba(255,255,255,0.08); }
    .chip { border: 1px solid rgba(255,255,255,0.14); }
    .glow { box-shadow: 0 0 0 1px rgba(16,185,129,.18), 0 0 60px rgba(16,185,129,.08) inset; }
    .ribbon { position:absolute; top:10px; right:-36px; rotate:45deg; background: linear-gradient(90deg, rgba(234,179,8,.95), rgba(250,204,21,.85)); color:#111827; font-weight:700; font-size:10px; letter-spacing:.08em; padding:4px 40px; border:1px solid rgba(255,255,255,.25); text-transform:uppercase; box-shadow: 0 6px 18px rgba(0,0,0,.35); }
    
    /* Cacher la barre de d√©filement */
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    
    /* Langue switcher */
    .lang-switch { display: flex; gap: 2px; background: rgba(255,255,255,0.05); border-radius: 8px; padding: 2px; border: 1px solid rgba(255,255,255,0.1); }
    .lang-btn { display: flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 6px; background: transparent; border: none; color: rgba(255,255,255,0.7); font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
    .lang-btn:hover { background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.9); }
    .lang-btn[aria-pressed="true"] { background: rgba(16,185,129,0.2); color: #10b981; border: 1px solid rgba(16,185,129,0.3); }
    .lang-btn:focus { outline: 2px solid #10b981; outline-offset: 2px; }
    .flag { width: 18px; height: 12px; border-radius: 2px; display: inline-block; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.2); overflow: hidden; flex-shrink: 0; }
    .flag-fr { background: linear-gradient(90deg, #0055A4 33.33%, #FFF 33.33% 66.66%, #EF4135 66.66%); }
    .flag-it { background: linear-gradient(90deg, #009246 33.33%, #FFF 33.33% 66.66%, #CE2B37 66.66%); }
    
    @media print { .no-print { display:none !important; } .print-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); } body { background: #fff; } }
  </style>
</head>
<body class="h-full text-slate-100 font-sans">
  <header class="no-print sticky top-0 z-50 border-b border-white/10 bg-ink-900/80 backdrop-blur">
    <div class="mx-auto max-w-7xl px-4 py-3 flex items-center gap-3">
      <div class="h-8 w-8 rounded-xl bg-brand-500/20 grid place-items-center text-brand-400">‚öôÔ∏è</div>
      <div class="flex-1">
        <h1 class="text-lg sm:text-xl font-semibold tracking-tight" data-i18n="app.title">Dashboard Projets 2025 - VILLAUME Nathan</h1>
        <p class="text-xs text-slate-400" data-i18n="app.subtitle">Synth√®se interactive ‚Äî ATS / ATR</p>
      </div>
      <div class="flex items-center gap-2">
        <div class="lang-switch" role="group" aria-label="S√©lecteur de langue">
          <button class="lang-btn" data-lang="fr" aria-pressed="true" aria-label="Passer en Fran√ßais">
            <span class="flag flag-fr" aria-hidden="true"></span><span>FR</span>
          </button>
          <button class="lang-btn" data-lang="it" aria-pressed="false" aria-label="Passare all'Italiano">
            <span class="flag flag-it" aria-hidden="true"></span><span>IT</span>
          </button>
        </div>
        <button id="btnShare" class="px-3 py-2 text-sm rounded-lg bg-white/10 hover:bg-white/20 border border-white/10 flex items-center gap-2" data-i18n-attr="title" title="Partager le dashboard">
          <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
          </svg>
          <span data-i18n="btn.share">Partager</span>
        </button>
      </div>
    </div>
  </header>

  <section class="mx-auto max-w-7xl px-4 pt-6">
    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
      <div class="card rounded-2xl p-4 shadow-glass">
        <p class="text-slate-400 text-xs" data-i18n="kpi.activeProjects">Projets actifs</p>
        <p id="kpiProjects" class="text-2xl font-semibold">‚Äî</p>
      </div>
      <div class="card rounded-2xl p-4 shadow-glass">
        <p class="text-slate-400 text-xs" data-i18n="kpi.deliveredResults">R√©sultats livr√©s</p>
        <p id="kpiResults" class="text-2xl font-semibold">‚Äî</p>
      </div>
      <div class="card rounded-2xl p-4 shadow-glass cursor-pointer hover:bg-white/5 transition-colors" id="kpiSkillsCard">
        <p class="text-slate-400 text-xs" data-i18n="kpi.skillsUsed">Comp√©tences mises en jeu üîç</p>
        <p id="kpiSkills" class="text-2xl font-semibold">‚Äî</p>
      </div>
    </div>
  </section>

  <section class="no-print mx-auto max-w-7xl px-4 py-4">
    <div class="flex flex-wrap items-center gap-2">
      <span class="text-xs text-slate-400" data-i18n="filters.label">Filtres :</span>
      <button data-filter="all" class="chip rounded-full px-3 py-1 text-xs bg-white/10 hover:bg-white/20" data-i18n="filters.all">Tout</button>
      <button data-filter="ATS" class="chip rounded-full px-3 py-1 text-xs bg-white/5 hover:bg-white/10">ATS</button>
      <button data-filter="ATR" class="chip rounded-full px-3 py-1 text-xs bg-white/5 hover:bg-white/10">ATR</button>
      <span class="mx-2 h-5 w-px bg-white/10"></span>
      <span class="text-xs text-slate-400" data-i18n="status.label">Statut :</span>
      <button data-status="all" class="chip rounded-full px-3 py-1 text-xs bg-white/10 hover:bg-white/20" data-i18n="status.all">Tous</button>
      <button data-status="en_cours" class="chip rounded-full px-3 py-1 text-xs bg-white/5 hover:bg-white/10" data-i18n="status.inProgress">üü° En cours</button>
      <button data-status="livre" class="chip rounded-full px-3 py-1 text-xs bg-white/5 hover:bg-white/10" data-i18n="status.completed">üü¢ Termin√©</button>
    </div>
  </section>

  <main class="mx-auto max-w-7xl px-4 pb-24">
    <div id="grid" class="grid print-grid grid-cols-1 md:grid-cols-2 gap-4"></div>
  </main>

  <div id="drawer" class="fixed inset-0 hidden z-50 flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/70 backdrop-blur-sm" data-close></div>
    <aside class="relative w-full max-w-4xl max-h-[90vh] bg-ink-800 border border-white/10 card overflow-y-auto rounded-2xl shadow-2xl hide-scrollbar">
      <div class="p-5 flex items-center justify-between border-b border-white/10 sticky top-0 bg-ink-800/80 backdrop-blur z-10">
        <div>
          <h3 id="drawerTitle" class="text-lg font-semibold"></h3>
          <p id="drawerArea" class="text-xs text-slate-400"></p>
        </div>
        <button class="px-3 py-2 text-sm rounded-lg bg-white/10 hover:bg-white/20" data-close data-i18n="btn.close">Fermer</button>
      </div>
      <div class="p-5 space-y-6">
        <section>
          <h4 class="text-sm uppercase tracking-wide text-slate-400 mb-2" data-i18n="drawer.objective">Objectif</h4>
          <p id="drawerObjective" class="text-slate-200"></p>
        </section>
        <section>
          <h4 class="text-sm uppercase tracking-wide text-slate-400 mb-2" data-i18n="drawer.realization">R√©alisation</h4>
          <ul id="drawerReal" class="list-disc list-inside marker:text-brand-500 space-y-1"></ul>
        </section>
        <section>
          <h4 class="text-sm uppercase tracking-wide text-slate-400 mb-2" data-i18n="drawer.results">R√©sultats</h4>
          <ul id="drawerResults" class="list-disc list-inside marker:text-emerald-400 space-y-1"></ul>
        </section>
        <section id="drawerSkillsSection">
          <h4 id="drawerSkillsTitle" class="text-sm uppercase tracking-wide text-slate-400 mb-2" data-i18n="drawer.skills">Comp√©tences</h4>
          <div id="drawerSkills" class="flex flex-wrap gap-2"></div>
        </section>
        <section id="drawerImagesSection">
          <h4 class="text-sm uppercase tracking-wide text-slate-400 mb-2" data-i18n="drawer.screenshots">üì∏ Captures d'√©cran</h4>
          <div id="drawerImages" class="grid grid-cols-2 gap-3"></div>
        </section>
        <section id="drawerMediaSection">
          <h4 class="text-sm uppercase tracking-wide text-slate-400 mb-2" data-i18n="drawer.media">D√©mos & m√©dias</h4>
          <div id="drawerMedia" class="grid grid-cols-2 gap-3"></div>
        </section>
        <section class="mt-6 p-4 rounded-xl bg-slate-800/60 border border-slate-600/30">
          <h4 class="text-sm uppercase tracking-wide text-slate-400 mb-3" data-i18n="comments.title">Commentaires</h4>
          <div id="commentsContainer"></div>
        </section>
      </div>
    </aside>
  </div>

  <!-- Modal image agrandie -->
  <div id="imageModal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 bg-black/90" onclick="closeImageModal()">
    <button class="absolute top-4 right-4 text-white text-4xl hover:text-brand-400 transition-colors" onclick="closeImageModal()">&times;</button>
    <div class="relative max-w-7xl max-h-[90vh]">
      <img id="modalImage" src="" alt="" class="max-w-full max-h-[90vh] object-contain rounded-lg" onclick="event.stopPropagation()" />
      <p id="modalImageTitle" class="text-center text-white mt-4 text-lg"></p>
    </div>
  </div>

  <footer class="fixed bottom-3 right-3 text-[11px] text-slate-400/80 no-print">
    <span data-i18n="footer.lastUpdate">Derni√®re mise √† jour</span> : <span id="lastUpdate"></span> ¬∑ <span data-i18n="footer.author">Auteur</span> : <span class="font-medium">N.Villaume</span>
  </footer>

  <script>
    // --- Syst√®me i18n ---
    (() => {
      const messages = {
        fr: {
          "app.title": "Dashboard Projets 2025 ‚Äî Nathan Villaume",
          "app.subtitle": "Synth√®se interactive ‚Äî ATS / ATR",
          "kpi.activeProjects": "Projets actifs",
          "kpi.deliveredResults": "R√©sultats livr√©s", 
          "kpi.skillsUsed": "Comp√©tences mises en jeu üîç",
          "filters.label": "Filtres :",
          "filters.all": "Tout",
          "status.label": "Statut :",
          "status.all": "Tous",
          "status.inProgress": "üü° En cours",
          "status.completed": "üü¢ Termin√©",
          "btn.share": "Partager",
          "btn.close": "Fermer",
          "btn.view": "Voir",
          "btn.details": "D√©tails",
          "drawer.objective": "Objectif",
          "drawer.realization": "R√©alisation",
          "drawer.results": "R√©sultats",
          "drawer.skills": "Comp√©tences",
          "drawer.screenshots": "üì∏ Captures d'√©cran",
          "drawer.media": "D√©mos & m√©dias",
          "card.objective": "üéØ Objectif",
          "card.realization": "R√©alisation",
          "card.results": "R√©sultats",
          "footer.lastUpdate": "Derni√®re mise √† jour",
          "footer.author": "Auteur",
          "skills.lexicon.title": "üìö Lexique des Comp√©tences",
          "skills.lexicon.subtitle": "comp√©tences techniques mobilis√©es",
          "skills.lexicon.description": "Ensemble des savoir-faire techniques mis en ≈ìuvre dans les projets 2025.",
          "skills.lexicon.clickHint": "üîç Cliquez sur une comp√©tence pour voir sa d√©finition",
          "skills.lexicon.defaultDesc": "Comp√©tence technique sp√©cialis√©e.",
          // Syst√®me de commentaires
          "comments.title": "Commentaires",
          "comments.add": "Ajouter un commentaire",
          "comments.placeholder": "√âcrivez votre commentaire...",
          "comments.send": "Envoyer",
          "comments.cancel": "Annuler",
          "comments.edit": "Modifier",
          "comments.delete": "Supprimer",
          "comments.reply": "R√©pondre",
          "comments.loading": "Chargement...",
          "comments.error": "Erreur lors du chargement",
          "comments.noComments": "Aucun commentaire pour le moment. Soyez le premier √† commenter !",
          "comments.nameLabel": "Nom",
          "comments.messageLabel": "Message",
          "comments.charCount": "/ 2000 caract√®res",
          "comments.loadMore": "Voir plus",
          "comments.namePlaceholder": "Votre nom",
          "comments.messagePlaceholder": "Votre commentaire...",
          // Menu de partage
          "share.title": "Partager le dashboard",
          "share.teams": "Ouvrir Teams + Copier message",
          "share.outlook": "Ouvrir Outlook (application)",
          "share.copy": "Copier le lien",
          // Traductions des projets
          "project.suivi-produit-ats.title": "Suivi Produit ‚Äì ATS",
          "project.suivi-produit-ats.objective": "Mettre en place une tra√ßabilit√© compl√®te des couronnes utilis√©es pour le treillis soud√©, du scan en entr√©e machine jusqu'au produit fini.",
          "project.suivi-produit-ats.real_short": ["Scan √©tiquettes des couronnes d'√©bauche", "Impression √©tiquettes roquette", "Base SQL stock roquette"],
          "project.suivi-produit-ats.real": ["Scan des √©tiquettes des couronne d'√©bauche", "Impression d'√©tiquettes roquette (poids r√©el/th√©orique, lot, coul√©e‚Ä¶)", "Base SQL pour gestion de stock", "Int√©gration supervision/production"],
          "project.suivi-produit-ats.results_short": ["Tra√ßabilit√© compl√®te", "R√©duction erreurs", "Conformit√© renforc√©e"],
          "project.suivi-produit-ats.results": ["Tra√ßabilit√© compl√®te bout-en-bout du scan d'entr√©e au produit fini", "R√©duction significative des erreurs humaines de saisie", "Optimisation logistique et conformit√© aux exigences qualit√©"],
          "project.gestion-rfid-ats.title": "Gestion RFID ‚Äì ATS",
          "project.gestion-rfid-ats.objective": "Chaque d√©marrage de machine est conditionn√© par la lecture du badge de pointage SAM, renfor√ßant ainsi la s√©curit√© et assurant une meilleure tra√ßabilit√©.",
          "project.gestion-rfid-ats.real_short": ["Badge obligatoire", "Base SQL √©quipes", "Stats op√©rateurs"],
          "project.gestion-rfid-ats.real": ["RFID obligatoire au d√©marrage de chaque machine", "Badge chef requis en cas de casse-fil pour validation", "Base SQL de gestion d'√©quipes et personnels", "Statistiques compl√®tes par op√©rateur et machine"],
          "project.gestion-rfid-ats.results_short": ["S√©curit√© renforc√©e", "Discipline accrue", "Tra√ßabilit√© op√©rateurs"],
          "project.gestion-rfid-ats.results": ["S√©curit√© renforc√©e avec contr√¥le d'acc√®s syst√©matique", "Discipline accrue et responsabilisation des √©quipes", "Suivi pr√©cis de la productivit√© par op√©rateur et par poste"],
          "project.gestion-rfid-atr.title": "Gestion RFID ‚Äì ATR",
          "project.gestion-rfid-atr.objective": "D√©ployer le m√™me dispositif RFID sur l'unit√© ATR (projet en cours).",
          "project.gestion-rfid-atr.real_short": ["Contr√¥le d√©marrage machines", "Adaptation base SQL existante", "Tra√ßabilit√© accrue"],
          "project.gestion-rfid-atr.real": ["Analyse des points de badgeage sur l'unit√© ATR", "Int√©gration avec base SQL existante", "Adaptation vues supervision et droits d'acc√®s", "Tra√ßabilit√© accrue"],
          "project.gestion-rfid-atr.results_short": ["POC en cours", "S√©curit√© cross-site", "Tra√ßabilit√© √©tendue"],
          "project.gestion-rfid-atr.results": ["Projet en cours (POC + phase de cadrage)", "S√©curit√© renforc√©e sur les deux sites (ATS/ATR)", "Tra√ßabilit√© cross-site unifi√©e", "Harmonisation des processus entre ATS et ATR"],
          "project.suivis-energies.title": "Suivis des Energies ‚Äì ATS / ATR",
          "project.suivis-energies.objective": "Donner une vision temps r√©el des mesure √©nerg√©tiques pour optimiser les co√ªts et d√©tecter les anomalies facilement.",
          "project.suivis-energies.real_short": ["Pose compteurs √©nergie", "Collecte OPC ‚Üí SQL", "Supervision web"],
          "project.suivis-energies.real": ["Pose de multiples compteurs d'√©nergie sur transformateurs et lignes", "Collecte automatique des donn√©es via OPC/IGS vers SQL Server", "Supervision ultra d√©taill√©e accessible depuis n'importe quel PC connect√© au r√©seau Sam/Riva, simplement via une URL", "Tableaux de bord interactifs avec graphiques temps r√©el"],
          "project.suivis-energies.results_short": ["Vision temps r√©el", "D√©tection anomalies", "Optimisation co√ªts"],
          "project.suivis-energies.results": ["Pilotage pr√©cis de l'√©nergie avec historiques d√©taill√©s", "D√©tection pr√©coce des d√©rives et anomalies de consommation", "Optimisation significative des co√ªts √©nerg√©tiques", "Support d√©cisionnel pour la direction avec KPIs √©nerg√©tiques"],
          "project.app-changement-gamme.title": "Application ¬´ Changement de Gamme ¬ª",
          "project.app-changement-gamme.objective": "Concevoir une application mobile destin√©e √† accompagner les √©quipes de production et de maintenance, afin d'optimiser leur efficacit√© et d'am√©liorer la coordination des changements de gammes.",
          "project.app-changement-gamme.real_short": ["Application Android", "API (Communication)", "Interface multi-devices"],
          "project.app-changement-gamme.real": ["Programmation native ANDROID en langage Kotlin", "API pour communication entre l'application et la base de donn√©es", "Navigation multi-√©crans adapt√©e (t√©l√©phone / tablette / PC)", "Interface Web d'administration pour gestion de l'utilisation de la tablette", "Syst√®me de notifications et guidage √©tape par √©tape"],
          "project.app-changement-gamme.results_short": ["Gain de temps", "Organisation am√©lior√©e", "Tra√ßabilit√© accrue"],
          "project.app-changement-gamme.results": ["Gain de temps significatif pour les √©quipes, avec une baisse des erreurs de saisie", "Organisation et structure des √©tapes de changement de gamme simplifi√©e", "Acc√®s direct aux r√©sultats et rapports de suivi en temps r√©el"],
          "project.suivis-soudures-atr.title": "Suivis des Soudures - ATR",
          "project.suivis-soudures-atr.objective": "Mettre en place un suivi et une tra√ßabilit√© compl√®te des soudures.",
          "project.suivis-soudures-atr.real_short": ["Table √©change SAM/PLC", "Base SQL historique", "Affichage dynamique"],
          "project.suivis-soudures-atr.real": ["Mise en place d'une table d'√©change standard entre le r√©seau SAM et les PLC des soudeuses", "Base SQL d√©di√©e pour historiser toutes les infos de soudure (date, ligne, lot, coul√©e, soudeur, param√®tres de soudage...)", "Affichage dynamique temps r√©el : liste des soudures + √©tat des soudeuses", "Saisie de commentaires en direct pour l'√©quipe de maintenance", "Export des donn√©es pour analyses qualit√©"],
          "project.suivis-soudures-atr.results_short": ["Tra√ßabilit√© soudures", "Visibilit√© √âtat soudeuses", "Analyses qualit√©"],
          "project.suivis-soudures-atr.results": ["Tra√ßabilit√© compl√®te des soudures et recuits avec historique d√©taill√©", "Visibilit√© accrue sur l'√©tat des machines en temps r√©el", "Communication facilit√©e entre production et maintenance", "Exploitation des donn√©es pour analyses qualit√© et maintenance pr√©dictive", "Conformit√© aux exigences de tra√ßabilit√© industrielle"],
          "project.camera-etiquette-atr.title": "D√©tection d'√©tiquette par Cam√©ra ‚Äì ATR",
          "project.camera-etiquette-atr.objective": "Emp√™cher qu'une bobine soit stock√©e sans √©tiquette.",
          "project.camera-etiquette-atr.real_short": ["Cam√©ra IFM LIGNE 7", "D√©tection √©tiquette", "Int√©gration Profinet"],
          "project.camera-etiquette-atr.real": ["Installation d'une cam√©ra IFM Vision Assistant sur le bobinoir de la ligne 7", "Param√©trage pr√©cis de l'algorithme de d√©tection d'√©tiquette (ROI, seuils, validation)", "Int√©gration compl√®te de la cam√©ra √† l'automate Siemens en Profinet", "Programmation du trigger pour piloter la cam√©ra au moment exact o√π l'√©tiquette est pos√©e", "Suivi statistique d√©taill√© des contr√¥les: nombre de d√©tections, taux de r√©ussite/√©chec, temps de cycle", "Interface op√©rateur pour visualisation en direct"],
          "project.camera-etiquette-atr.results_short": ["Z√©ro d√©faut √©tiquette", "Contr√¥le automatique", "Fiabilit√© 100%"],
          "project.camera-etiquette-atr.results": ["Suppression totale des risques d'exp√©dition de bobines sans √©tiquette", "Contr√¥le automatis√© ultra-rapide sans aucune surcharge pour l'op√©rateur", "Fiabilit√© renforc√©e du processus de production", "R√©duction drastique des non-conformit√©s client", "ROI rapide par √©limination des reprises et retours"],
          // L√©gendes d'images
          "image.etiquette-roquette": "√âtiquette roquette",
          "image.interface-supervision": "Interface supervision",
          "image.interface-rfid": "Interface RFID",
          "image.badge-operateur": "Badge op√©rateur",
          "image.interface-rfid-atr": "Interface RFID ATR",
          "image.tableau-bord-energetique": "Tableau de bord √©nerg√©tique",
          "image.ecran-accueil": "√âcran d'accueil",
          "image.liste-gammes": "Liste des Gammes",
          "image.validation-etapes": "Validation √©tapes",
          "image.interface-parametres": "Interface Param√®tres",
          "image.supervision-soudures": "Supervision soudures",
          "image.historique-parametres": "Historique param√®tres",
          "image.camera-detection": "Cam√©ra de d√©tection",
          // Zones des projets
          "area.ats-supervision-sql": "ATS ¬∑ Supervision ¬∑ SQL",
          "area.ats-rfid-securite": "ATS ¬∑ RFID ¬∑ S√©curit√©",
          "area.atr-rfid-securite": "ATR ¬∑ RFID ¬∑ S√©curit√©",
          "area.ats-atr-web-dataviz": "ATS ¬∑ ATR ¬∑ Web ¬∑ DataViz",
          "area.android-api-ux": "Android ¬∑ API ¬∑ UX",
          "area.atr-supervision-qualite": "ATR ¬∑ Supervision ¬∑ Qualit√©",
          "area.atr-vision-automatisme": "ATR ¬∑ Vision ¬∑ Automatisme"
        },
        it: {
          "app.title": "Dashboard Progetti 2025 ‚Äî Nathan Villaume",
          "app.subtitle": "Sintesi interattiva ‚Äî ATS / ATR",
          "kpi.activeProjects": "Progetti attivi",
          "kpi.deliveredResults": "Risultati consegnati",
          "kpi.skillsUsed": "Competenze utilizzate üîç",
          "filters.label": "Filtri :",
          "filters.all": "Tutto",
          "status.label": "Stato :",
          "status.all": "Tutti",
          "status.inProgress": "üü° In corso",
          "status.completed": "üü¢ Completato",
          "btn.share": "Condividi",
          "btn.close": "Chiudi",
          "btn.view": "Visualizza",
          "btn.details": "Dettagli",
          "drawer.objective": "Obiettivo",
          "drawer.realization": "Realizzazione",
          "drawer.results": "Risultati",
          "drawer.skills": "Competenze",
          "drawer.screenshots": "üì∏ Screenshot",
          "drawer.media": "Demo & media",
          "card.objective": "üéØ Obiettivo",
          "card.realization": "Realizzazione",
          "card.results": "Risultati",
          "footer.lastUpdate": "Ultimo aggiornamento",
          "footer.author": "Autore",
          "skills.lexicon.title": "üìö Lessico delle Competenze",
          "skills.lexicon.subtitle": "competenze tecniche utilizzate",
          "skills.lexicon.description": "Insieme delle competenze tecniche utilizzate nei progetti 2025.",
          "skills.lexicon.clickHint": "üîç Clicca su una competenza per vedere la sua definizione",
          "skills.lexicon.defaultDesc": "Competenza tecnica specializzata.",
          // Syst√®me de commentaires
          "comments.title": "Commenti",
          "comments.add": "Aggiungi un commento",
          "comments.placeholder": "Scrivi il tuo commento...",
          "comments.send": "Invia",
          "comments.cancel": "Annulla",
          "comments.edit": "Modifica",
          "comments.delete": "Elimina",
          "comments.reply": "Rispondi",
          "comments.loading": "Caricamento...",
          "comments.error": "Errore durante il caricamento",
          "comments.noComments": "Nessun commento al momento. Sii il primo a commentare !",
          "comments.nameLabel": "Nome",
          "comments.messageLabel": "Messaggio",
          "comments.charCount": "/ 2000 caratteri",
          "comments.loadMore": "Vedi di pi√π",
          "comments.namePlaceholder": "Il tuo nome",
          "comments.messagePlaceholder": "Il tuo commento...",
          // Menu de partage
          "share.title": "Condividi la dashboard",
          "share.teams": "Apri Teams + Copia messaggio",
          "share.outlook": "Apri Outlook (applicazione)",
          "share.copy": "Copia il link",
          // Traductions des projets en italien
          "project.suivi-produit-ats.title": "Tracciamento Prodotto ‚Äì ATS",
          "project.suivi-produit-ats.objective": "Implementare una tracciabilit√† completa delle corone utilizzate per il traliccio saldato, dalla scansione in entrata macchina fino al prodotto finito.",
          "project.suivi-produit-ats.real_short": ["Scansione etichette corone grezze", "Stampa etichette rocchetta", "Base SQL stock rocchetta"],
          "project.suivi-produit-ats.real": ["Scansione delle etichette delle corone grezze", "Stampa di etichette rocchetta (peso reale/teorico, lotto, colata...)", "Base SQL per gestione stock", "Integrazione supervisione/produzione"],
          "project.suivi-produit-ats.results_short": ["Tracciabilit√† completa", "Riduzione errori", "Conformit√† rafforzata"],
          "project.suivi-produit-ats.results": ["Tracciabilit√† completa end-to-end dalla scansione di entrata al prodotto finito", "Riduzione significativa degli errori umani di inserimento", "Ottimizzazione logistica e conformit√† ai requisiti qualit√†"],
          "project.gestion-rfid-ats.title": "Gestione RFID ‚Äì ATS",
          "project.gestion-rfid-ats.objective": "Ogni avvio di macchina √® condizionato dalla lettura del badge di timbratura SAM, rafforzando cos√¨ la sicurezza e garantendo una migliore tracciabilit√†.",
          "project.gestion-rfid-ats.real_short": ["Badge obbligatorio", "Base SQL squadre", "Statistiche operatori"],
          "project.gestion-rfid-ats.real": ["RFID obbligatorio all'avvio di ogni macchina", "Badge capo richiesto in caso di rottura filo per validazione", "Base SQL di gestione squadre e personale", "Statistiche complete per operatore e macchina"],
          "project.gestion-rfid-ats.results_short": ["Sicurezza rafforzata", "Disciplina maggiore", "Tracciabilit√† operatori"],
          "project.gestion-rfid-ats.results": ["Sicurezza rafforzata con controllo accessi sistematico", "Disciplina maggiore e responsabilizzazione delle squadre", "Monitoraggio preciso della produttivit√† per operatore e per postazione"],
          "project.gestion-rfid-atr.title": "Gestione RFID ‚Äì ATR",
          "project.gestion-rfid-atr.objective": "Implementare lo stesso dispositivo RFID sull'unit√† ATR (progetto in corso).",
          "project.gestion-rfid-atr.real_short": ["Controllo avvio macchine", "Adattamento base SQL esistente", "Tracciabilit√† aumentata"],
          "project.gestion-rfid-atr.real": ["Analisi dei punti di timbratura sull'unit√† ATR", "Integrazione con base SQL esistente", "Adattamento viste supervisione e diritti di accesso", "Tracciabilit√† aumentata"],
          "project.gestion-rfid-atr.results_short": ["POC in corso", "Sicurezza cross-site", "Tracciabilit√† estesa"],
          "project.gestion-rfid-atr.results": ["Progetto in corso (POC + fase di definizione)", "Sicurezza rafforzata sui due siti (ATS/ATR)", "Tracciabilit√† cross-site unificata", "Armonizzazione dei processi tra ATS e ATR"],
          "project.suivis-energies.title": "Monitoraggio Energie ‚Äì ATS / ATR",
          "project.suivis-energies.objective": "Fornire una visione in tempo reale delle misurazioni energetiche per ottimizzare i costi e rilevare facilmente le anomalie.",
          "project.suivis-energies.real_short": ["Installazione contatori energia", "Raccolta OPC ‚Üí SQL", "Supervisione web"],
          "project.suivis-energies.real": ["Installazione di multipli contatori di energia su trasformatori e linee", "Raccolta automatica dei dati via OPC/IGS verso SQL Server", "Supervisione ultra dettagliata accessibile da qualsiasi PC connesso alla rete Sam/Riva, semplicemente tramite un URL", "Dashboard interattivi con grafici tempo reale"],
          "project.suivis-energies.results_short": ["Visione tempo reale", "Rilevamento anomalie", "Ottimizzazione costi"],
          "project.suivis-energies.results": ["Pilotaggio preciso dell'energia con storici dettagliati", "Rilevamento precoce delle derive e anomalie di consumo", "Ottimizzazione significativa dei costi energetici", "Supporto decisionale per la direzione con KPI energetici"],
          "project.app-changement-gamme.title": "Applicazione ¬´ Cambio Gammes ¬ª",
          "project.app-changement-gamme.objective": "Progettare un'applicazione mobile destinata ad accompagnare i team di produzione e manutenzione, al fine di ottimizzare la loro efficienza e migliorare il coordinamento dei cambi gammes.",
          "project.app-changement-gamme.real_short": ["Applicazione Android", "API (Comunicazione)", "Interfaccia multi-dispositivi"],
          "project.app-changement-gamme.real": ["Programmazione nativa ANDROID in linguaggio Kotlin", "API per comunicazione tra l'applicazione e il database", "Navigazione multi-schermo adattata (telefono / tablet / PC)", "Interfaccia Web di amministrazione per gestione dell'utilizzo del tablet", "Sistema di notifiche e guida passo dopo passo"],
          "project.app-changement-gamme.results_short": ["Risparmio tempo", "Organizzazione migliorata", "Tracciabilit√† aumentata"],
          "project.app-changement-gamme.results": ["Risparmio di tempo significativo per i team, con una diminuzione degli errori di inserimento", "Organizzazione e struttura delle fasi di cambio gamme semplificata", "Accesso diretto ai risultati e rapporti di monitoraggio in tempo reale"],
          "project.suivis-soudures-atr.title": "Monitoraggio Saldature - ATR",
          "project.suivis-soudures-atr.objective": "Implementare un monitoraggio e una tracciabilit√† completa delle saldature.",
          "project.suivis-soudures-atr.real_short": ["Tabella scambio SAM/PLC", "Base SQL storico", "Visualizzazione dinamica"],
          "project.suivis-soudures-atr.real": ["Implementazione di una tabella di scambio standard tra la rete SAM e i PLC delle saldatrici", "Base SQL dedicata per storificare tutte le informazioni di saldatura (data, linea, lotto, colata, saldatore, parametri di saldatura...)", "Visualizzazione dinamica tempo reale: lista delle saldature + stato delle saldatrici", "Inserimento commenti in diretta per il team di manutenzione", "Export dei dati per analisi qualit√†"],
          "project.suivis-soudures-atr.results_short": ["Tracciabilit√† saldature", "Visibilit√† stato saldatrici", "Analisi qualit√†"],
          "project.suivis-soudures-atr.results": ["Tracciabilit√† completa delle saldature e ricotture con storico dettagliato", "Visibilit√† aumentata sullo stato delle macchine in tempo reale", "Comunicazione facilitata tra produzione e manutenzione", "Sfruttamento dei dati per analisi qualit√† e manutenzione predittiva", "Conformit√† ai requisiti di tracciabilit√† industriale"],
          "project.camera-etiquette-atr.title": "Rilevamento etichetta tramite Camera ‚Äì ATR",
          "project.camera-etiquette-atr.objective": "Impedire che una bobina venga stoccata senza etichetta.",
          "project.camera-etiquette-atr.real_short": ["Camera IFM LINEA 7", "Rilevamento etichetta", "Integrazione Profinet"],
          "project.camera-etiquette-atr.real": ["Installazione di una camera IFM Vision Assistant sul bobinoio della linea 7", "Configurazione precisa dell'algoritmo di rilevamento etichetta (ROI, soglie, validazione)", "Integrazione completa della camera all'automata Siemens in Profinet", "Programmazione del trigger per pilotare la camera nel momento esatto in cui l'etichetta viene posizionata", "Monitoraggio statistico dettagliato dei controlli: numero di rilevamenti, tasso di successo/fallimento, tempo di ciclo", "Interfaccia operatore per visualizzazione in diretta"],
          "project.camera-etiquette-atr.results_short": ["Zero difetti etichetta", "Controllo automatico", "Affidabilit√† 100%"],
          "project.camera-etiquette-atr.results": ["Eliminazione totale dei rischi di spedizione bobine senza etichetta", "Controllo automatizzato ultra-rapido senza alcun sovraccarico per l'operatore", "Affidabilit√† rafforzata del processo di produzione", "Riduzione drastica delle non conformit√† cliente", "ROI rapido per eliminazione delle riprese e ritorni"],
          // L√©gendes d'images en italien
          "image.etiquette-roquette": "Etichetta rocchetta",
          "image.interface-supervision": "Interfaccia supervisione",
          "image.interface-rfid": "Interfaccia RFID",
          "image.badge-operateur": "Badge operatore",
          "image.interface-rfid-atr": "Interfaccia RFID ATR",
          "image.tableau-bord-energetique": "Dashboard energetico",
          "image.ecran-accueil": "Schermata di benvenuto",
          "image.liste-gammes": "Lista Gammes",
          "image.validation-etapes": "Validazione fasi",
          "image.interface-parametres": "Interfaccia Parametri",
          "image.supervision-soudures": "Supervisione saldature",
          "image.historique-parametres": "Storico parametri",
          "image.camera-detection": "Camera di rilevamento",
          // Zones des projets en italien
          "area.ats-supervision-sql": "ATS ¬∑ Supervisione ¬∑ SQL",
          "area.ats-rfid-securite": "ATS ¬∑ RFID ¬∑ Sicurezza",
          "area.atr-rfid-securite": "ATR ¬∑ RFID ¬∑ Sicurezza",
          "area.ats-atr-web-dataviz": "ATS ¬∑ ATR ¬∑ Web ¬∑ DataViz",
          "area.android-api-ux": "Android ¬∑ API ¬∑ UX",
          "area.atr-supervision-qualite": "ATR ¬∑ Supervisione ¬∑ Qualit√†",
          "area.atr-vision-automatisme": "ATR ¬∑ Visione ¬∑ Automazione"
        }
      };

      const state = { lang: "fr" };

      const applyI18n = () => {
        const root = document;
        const dict = messages[state.lang] || messages.fr;

        // Text nodes
        root.querySelectorAll("[data-i18n]").forEach(el => {
          const key = el.getAttribute("data-i18n");
          if (dict[key] != null) el.textContent = String(dict[key]);
        });

        // Attribute bindings (comma-separated)
        root.querySelectorAll("[data-i18n-attr]").forEach(el => {
          const key = el.getAttribute("data-i18n");
          const attrs = el.getAttribute("data-i18n-attr").split(",").map(s => s.trim());
          const val = dict[key];
          if (val != null) attrs.forEach(a => el.setAttribute(a, String(val)));
        });

        // Title tag if marked
        const titleEl = document.querySelector("title[data-i18n]");
        if (titleEl) {
          const key = titleEl.getAttribute("data-i18n");
          if (dict[key] != null) titleEl.textContent = String(dict[key]);
        }

        // Toggle pressed state on language buttons
        document.querySelectorAll(".lang-btn").forEach(btn => {
          btn.setAttribute("aria-pressed", btn.dataset.lang === state.lang ? "true" : "false");
        });

        // Update language switcher aria-labels
        const frBtn = document.querySelector('.lang-btn[data-lang="fr"]');
        const itBtn = document.querySelector('.lang-btn[data-lang="it"]');
        if (frBtn) frBtn.setAttribute('aria-label', state.lang === 'fr' ? 'Passer en Fran√ßais (actuel)' : 'Passer en Fran√ßais');
        if (itBtn) itBtn.setAttribute('aria-label', state.lang === 'it' ? 'Passare all\'Italiano (attuale)' : 'Passare all\'Italiano');
      };

      const setLang = (lang) => {
        state.lang = (lang === "it") ? "it" : "fr";
        localStorage.setItem("lang", state.lang);
        window.requestAnimationFrame(applyI18n);
        
        // Update dynamic content
        if (window.updateDynamicContent) {
          window.updateDynamicContent();
        }
      };

      const getLang = () => state.lang;
      const t = (key, params) => {
        const dict = messages[state.lang] || messages.fr;
        let text = dict[key] || key;
        if (params) {
          Object.keys(params).forEach(k => {
            text = text.replace(new RegExp(`{${k}}`, 'g'), params[k]);
          });
        }
        return text;
      };

      // Init
      document.addEventListener("DOMContentLoaded", () => {
        const saved = localStorage.getItem("lang");
        const guessed = navigator.language?.toLowerCase().startsWith("it") ? "it" : "fr";
        state.lang = saved || guessed || "fr";

        document.body.addEventListener("click", (e) => {
          const btn = e.target.closest(".lang-btn");
          if (btn?.dataset?.lang) {
            setLang(btn.dataset.lang);
          }
        });

        applyI18n();
      });

      // Expose globally
      window.i18n = { setLang, getLang, t, messages };
      window.updateDynamicContent = () => {
        // This will be called when language changes to update dynamic content
        if (window.renderCards && window.DATA) {
          window.renderCards(window.DATA);
        }
        if (window.showAllSkills) {
          // Update skills lexicon if it's currently displayed
          const drawer = document.getElementById('drawer');
          if (!drawer.classList.contains('hidden') && document.getElementById('drawerTitle')?.textContent.includes('Lexique')) {
            window.showAllSkills();
          }
        }
        
        // Update comments system if it exists
        if (window.commentsComponent && window.currentProjectId) {
          // Reinitialize comments with new language
          window.commentsComponent.setEntity(window.currentProjectId);
        }
        
        // Apply translations to comments component if it exists
        if (window.commentsComponent) {
          window.commentsComponent.applyTranslations();
        }
      };
    })();

    // --- Donn√©es projets ---
    const DATA = [
      {
        id: "suivi-produit-ats",
        title: "Suivi Produit ‚Äì ATS",
        area: "ATS ¬∑ Supervision ¬∑ SQL",
        filters: ["ATS","Supervision","SQL"],
        status: "livre",
        objective: "Mettre en place une tra√ßabilit√© compl√®te des couronnes utilis√©es pour le treillis soud√©, du scan en entr√©e machine jusqu'au produit fini.",
        real_short: [
          "Scan √©tiquettes des couronnes d'√©bauche",
          "Impression √©tiquettes roquette",
          "Base SQL stock roquette"
        ],
        real: [
          "Scan des √©tiquettes des couronne d'√©bauche",
          "Impression d'√©tiquettes roquette (poids r√©el/th√©orique, lot, coul√©e‚Ä¶)",
          "Base SQL pour gestion de stock",
          "Int√©gration supervision/production"
        ],
        results_short: [
          "Tra√ßabilit√© compl√®te",
          "R√©duction erreurs",
          "Conformit√© renforc√©e"
        ],
        results: [
          "Tra√ßabilit√© compl√®te bout-en-bout du scan d'entr√©e au produit fini",
          "R√©duction significative des erreurs humaines de saisie",
          "Optimisation logistique et conformit√© aux exigences qualit√©"
        ],
        skills: ["SQL Server","Automatisme","RFID","Cimplicity","Basic Script","Gestion projet"],
        images: [
          { src: '/images/projets/suivi-produit-1.jpg?v=2', title: '√âtiquette roquette' },
          { src: '/images/projets/suivi-produit-2.jpg?v=3', title: 'Interface supervision' }
        ],
        media: []
      },
      {
        id: "gestion-rfid-ats",
        title: "Gestion RFID ‚Äì ATS",
        area: "ATS ¬∑ RFID ¬∑ S√©curit√©",
        filters: ["ATS","RFID","SQL","Supervision"],
        status: "livre",
        objective: "Chaque d√©marrage de machine est conditionn√© par la lecture du badge de pointage SAM, renfor√ßant ainsi la s√©curit√© et assurant une meilleure tra√ßabilit√©.",
        real_short: [
          "Badge obligatoire",
          "Base SQL √©quipes",
          "Stats op√©rateurs"
        ],
        real: [
          "RFID obligatoire au d√©marrage de chaque machine",
          "Badge chef requis en cas de casse-fil pour validation",
          "Base SQL de gestion d'√©quipes et personnels",
          "Statistiques compl√®tes par op√©rateur et machine"
        ],
        results_short: [
          "S√©curit√© renforc√©e",
          "Discipline accrue",
          "Tra√ßabilit√© op√©rateurs"
        ],
        results: [
          "S√©curit√© renforc√©e avec contr√¥le d'acc√®s syst√©matique",
          "Discipline accrue et responsabilisation des √©quipes",
          "Suivi pr√©cis de la productivit√© par op√©rateur et par poste"
        ],
        skills: ["C#","SQL Server","Cimplicity","Basic Script","RFID"],
        images: [
          { src: '/images/projets/Gestion_RFID_ATS-1.jpg?v=2', title: 'Interface RFID' },
          { src: '/images/projets/Gestion_RFID_ATS-2.jpg?v=2', title: 'Badge op√©rateur' }
        ],
        media: []
      },
      {
        id: "gestion-rfid-atr",
        title: "Gestion RFID ‚Äì ATR",
        area: "ATR ¬∑ RFID ¬∑ S√©curit√©",
        filters: ["ATR","RFID","SQL","Supervision"],
        status: "en_cours",
        objective: "D√©ployer le m√™me dispositif RFID sur l'unit√© ATR (projet en cours).",
        real_short: [
          "Controle d√©mmarage machines",
          "Adaptation base SQL existante",
          "Tracabilit√© Accrue"
        ],
        real: [
          "Analyse des points de badgeage sur l'unit√© ATR",
          "Int√©gration avec base SQL existante",
          "Adaptation vues supervision et droits d'acc√®s",
          "Tracabilit√© Accrue"
        ],
        results_short: [
          "POC en cours",
          "S√©curit√© cross-site",
          "Tra√ßabilit√© √©tendue"
        ],
        results: [
          "Projet en cours (POC + phase de cadrage)",
          "S√©curit√© renforc√©e sur les deux sites (ATS/ATR)",
          "Tra√ßabilit√© cross-site unifi√©e",
          "Harmonisation des processus entre ATS et ATR"
        ],
        skills: ["C#","SQL Server","Cimplicity","Basic Script","RFID","D√©ploiement multi-site"],
        images: [
          { src: '/images/projets/Gestion_RFID_ATR-1.jpg?v=1', title: 'Interface RFID ATR' }
        ],
        media: []
      },
      {
        id: "suivis-energies",
        title: "Suivis des Energies ‚Äì ATS / ATR",
        area: "ATS ¬∑ ATR ¬∑ Web ¬∑ DataViz",
        filters: ["ATS","ATR","SQL","Supervision"],
        status: "livre",
        objective: "Donner une vision temps r√©el des mesure √©nerg√©tiques pour optimiser les co√ªts et d√©tecter les anomalies facilement.",
        real_short: [
          "Pose compteurs √©nergie",
          "Collecte OPC ‚Üí SQL",
          "Supervision web"
        ],
        real: [
          "Pose de multiples compteurs d'√©nergie sur transformateurs et lignes",
          "Collecte automatique des donn√©es via OPC/IGS vers SQL Server",
          "Supervision ultra d√©taill√©e accessible depuis n'importe quel PC connect√© au r√©seau Sam/Riva, simplement via une URL",
          "Tableaux de bord interactifs avec graphiques temps r√©el"
        ],
        results_short: [
          "Vision temps r√©el",
          "D√©tection anomalies",
          "Optimisation co√ªts"
        ],
        results: [
          "Pilotage pr√©cis de l'√©nergie avec historiques d√©taill√©s",
          "D√©tection pr√©coce des d√©rives et anomalies de consommation",
          "Optimisation significative des co√ªts √©nerg√©tiques",
          "Support d√©cisionnel pour la direction avec KPIs √©nerg√©tiques"
        ],
        skills: ["OPC","S7","HTML5","Tailwind CSS","Chart.js","SQL Server","Communication industrielle"],
        images: [
          { src: '/images/projets/Suivis_des_Energies-1.jpg', title: 'Tableau de bord √©nerg√©tique' }
        ],
        media: [
          { type: "chart", label: "TR1 ‚Äî conso synth√®se" }
        ]
      },
      {
        id: "app-changement-gamme",
        title: "Application ¬´ Changement de Gamme ¬ª",
        area: "Android ¬∑ API ¬∑ UX",
        filters: ["Android","ATS"],
        status: "livre",
        objective: "Concevoir une application mobile destin√©e √† accompagner les √©quipes de production et de maintenance, afin d'optimiser leur efficacit√© et d'am√©liorer la coordination des changements de gammes.",
        real_short: [
          "Application Android",
          "API (Communication)",
          "Interface multi-devices"
        ],
        real: [
          "Programmation native ANDROID en langage Kotlin",
          "API   pour communication entre l'application et la base de donn√©es",
          "Navigation multi-√©crans adapt√©e (t√©l√©phone / tablette / PC)",
          "Interface Web d'administration pour gestion de l'utilisation de la tablette",
          "Syst√®me de notifications et guidage √©tape par √©tape"
        ],
        results_short: [
          "Gain de temps",
          "Organisation am√©lior√©e",
          "Tracabilit√© accrue"
        ],
        results: [
          "Gain de temps significatif pour les √©quipes, avec une baisse des erreurs de saisie",
          "Organisation et structure des √©tapes de changement de gamme simplifi√©e",
          "Acc√®s direct aux r√©sultats et rapports de suivi en temps r√©el"
        ],
        skills: ["Android","Kotlin","Retrofit","API REST","Architecture client/serveur","UI/UX"],
        images: [
          { src: '/images/projets/Appli_Chgt_Gamme_1.png?v=2', title: '√âcran d\'accueil' },
          { src: '/images/projets/Appli_Chgt_Gamme_2.png?v=2', title: 'Liste des Gammes' },
          { src: '/images/projets/Appli_Chgt_Gamme_3.png?v=2', title: 'Validation √©tapes' },
          { src: '/images/projets/Appli_Chgt_Gamme_4.png?v=2', title: 'Interface Parametres' }
        ],
        media: []
      },
      {
        id: "suivis-soudures-atr",
        title: "Suivis des Soudures - ATR",
        area: "ATR ¬∑ Supervision ¬∑ Qualit√©",
        filters: ["ATR","Supervision","SQL"],
        status: "livre",
        objective: "Mettre en place un suivi et une tra√ßabilit√© compl√®te des soudures.",
        real_short: [
          "Table √©change SAM/PLC",
          "Base SQL historique",
          "Affichage dynamique"
        ],
        real: [
          "Mise en place d'une table d'√©change standard entre le r√©seau SAM et les PLC des soudeuses",
          "Base SQL d√©di√©e pour historiser toutes les infos de soudure (date, ligne, lot, coul√©e, soudeur, param√®tres de soudage...)",
          "Affichage dynamique temps r√©el : liste des soudures + √©tat des soudeuses",
          "Saisie de commentaires en direct pour l'√©quipe de maintenance",
          "Export des donn√©es pour analyses qualit√©"
        ],
        results_short: [
          "Tra√ßabilit√© soudures",
          "Visibilit√© Etat soudeuses",
          "Analyses qualit√©"
        ],
        results: [
          "Tra√ßabilit√© compl√®te des soudures et recuits avec historique d√©taill√©",
          "Visibilit√© accrue sur l'√©tat des machines en temps r√©el",
          "Communication facilit√©e entre production et maintenance",
          "Exploitation des donn√©es pour analyses qualit√© et maintenance pr√©dictive",
          "Conformit√© aux exigences de tra√ßabilit√© industrielle"
        ],
        skills: ["Cimplicity","Basic Script","SQL Server","R√©seau industriel","Analyse de donn√©es"],
        images: [
          { src: '/images/projets/SuivisSoudure-1.jpg', title: 'Supervision soudures' },
          { src: '/images/projets/SuivisSoudure-2.jpg', title: 'Historique param√®tres' }
        ],
        media: []
      },
      {
        id: "camera-etiquette-atr",
        title: "D√©tection d'√©tiquette par Cam√©ra ‚Äì ATR",
        area: "ATR ¬∑ Vision ¬∑ Automatisme",
        filters: ["ATR","Vision","Automatisme"],
        status: "livre",
        objective: "Emp√™cher qu'une bobine sois stock√©e sans √©tiquette.",
        real_short: [
          "Cam√©ra IFM LIGNE 7",
          "D√©tection √©tiquette",
          "Int√©gration Profinet"
        ],
        real: [
          "Installation d'une cam√©ra IFM Vision Assistant sur le bobinoir de la ligne 7",
          "Param√©trage pr√©cis de l'algorithme de d√©tection d'√©tiquette (ROI, seuils, validation)",
          "Int√©gration compl√®te de la cam√©ra √† l'automate Siemens en Profinet",
          "Programmation du trigger pour piloter la cam√©ra au moment exact o√π l'√©tiquette est pos√©e",
          "Suivi statistique d√©taill√© des contr√¥les: nombre de d√©tections, taux de r√©ussite/√©chec, temps de cycle",
          "Interface op√©rateur pour visualisation en direct"
        ],
        results_short: [
          "Z√©ro d√©faut √©tiquette",
          "Contr√¥le automatique",
          "Fiabilit√© 100%"
        ],
        results: [
          "Suppression totale des risques d'exp√©dition de bobines sans √©tiquette",
          "Contr√¥le automatis√© ultra-rapide sans aucune surcharge pour l'op√©rateur",
          "Fiabilit√© renforc√©e du processus de production",
          "R√©duction drastique des non-conformit√©s client",
          "ROI rapide par √©limination des reprises et retours"
        ],
        skills: ["Vision industrielle","IFM Vision Assistant","Automatisme","Profinet","Statistiques"],
        images: [
          { src: '/images/projets/D√©tection_Etiquette-1.jpg', title: 'Cam√©ra de d√©tection' }
        ],
        media: []
      }
    ];

    // Fallback
    DATA.forEach(p => { if (!p.status) p.status = 'livre'; });

    // --- Variables globales ---
    const grid = document.getElementById('grid');
    const btnShare = document.getElementById('btnShare');
    const drawer = document.getElementById('drawer');
    const drawerTitle = document.getElementById('drawerTitle');
    const drawerArea = document.getElementById('drawerArea');
    const drawerObjective = document.getElementById('drawerObjective');
    const drawerReal = document.getElementById('drawerReal');
    const drawerResults = document.getElementById('drawerResults');
    const drawerSkills = document.getElementById('drawerSkills');
    const drawerMedia = document.getElementById('drawerMedia');
    const drawerMediaSection = document.getElementById('drawerMediaSection');
    const drawerImages = document.getElementById('drawerImages');
    const drawerImagesSection = document.getElementById('drawerImagesSection');
    const drawerSkillsSection = document.getElementById('drawerSkillsSection');
    const drawerSkillsTitle = document.getElementById('drawerSkillsTitle');
    let currentProjectId = null;

    let activeFilter = 'all';
    let activeStatus = 'all';

    // --- Composant de commentaires V2 ---
    let commentsComponent = null;

    // --- Fonctions utilitaires ---
    function chip(txt) {
      return `<span class="chip text-[11px] px-2 py-1 rounded-full bg-white/5">${txt}</span>`;
    }

    function uniq(arr) { 
      return [...new Set(arr)]; 
    }

    // --- Gestion du drawer ---
    function openDrawer(p) {
      currentProjectId = p.id;
      window.currentProjectId = currentProjectId;
      
      // Utiliser les traductions si disponibles, sinon fallback sur les donn√©es originales
      const projectTitle = window.i18n.t(`project.${p.id}.title`) || p.title;
      const projectObjective = window.i18n.t(`project.${p.id}.objective`) || p.objective;
      const projectReal = window.i18n.t(`project.${p.id}.real`) || p.real;
      const projectResults = window.i18n.t(`project.${p.id}.results`) || p.results;
      
      // Mapping des zones des projets
      const areaMapping = {
        'ATS ¬∑ Supervision ¬∑ SQL': window.i18n.t('area.ats-supervision-sql'),
        'ATS ¬∑ RFID ¬∑ S√©curit√©': window.i18n.t('area.ats-rfid-securite'),
        'ATR ¬∑ RFID ¬∑ S√©curit√©': window.i18n.t('area.atr-rfid-securite'),
        'ATS ¬∑ ATR ¬∑ Web ¬∑ DataViz': window.i18n.t('area.ats-atr-web-dataviz'),
        'Android ¬∑ API ¬∑ UX': window.i18n.t('area.android-api-ux'),
        'ATR ¬∑ Supervision ¬∑ Qualit√©': window.i18n.t('area.atr-supervision-qualite'),
        'ATR ¬∑ Vision ¬∑ Automatisme': window.i18n.t('area.atr-vision-automatisme')
      };
      
      const translatedArea = areaMapping[p.area] || p.area;
      
      drawerTitle.textContent = projectTitle;
      drawerArea.textContent = translatedArea;
      drawerObjective.textContent = projectObjective;
      drawerReal.innerHTML = projectReal.map(x=>`<li>${x}</li>`).join('');
      drawerResults.innerHTML = projectResults.map(x=>`<li>${x}</li>`).join('');
      
      // R√©initialiser la section des comp√©tences pour un projet normal
      drawerSkillsSection.classList.remove('hidden');
      drawerSkillsTitle.textContent = window.i18n.t('drawer.skills');
      drawerSkills.innerHTML = p.skills.map(chip).join('');

      // Charger les commentaires avec le nouveau composant V2
      if (commentsComponent) {
        commentsComponent.setEntity(p.id);
      }

      // Afficher les images
      if (!p.images || p.images.length === 0) {
        drawerImagesSection.classList.add('hidden');
      } else {
        drawerImagesSection.classList.remove('hidden');
        drawerImages.innerHTML = p.images.map((img, i) => {
          // Mapping des l√©gendes d'images
          const titleMapping = {
            '√âtiquette roquette': window.i18n.t('image.etiquette-roquette'),
            'Interface supervision': window.i18n.t('image.interface-supervision'),
            'Interface RFID': window.i18n.t('image.interface-rfid'),
            'Badge op√©rateur': window.i18n.t('image.badge-operateur'),
            'Interface RFID ATR': window.i18n.t('image.interface-rfid-atr'),
            'Tableau de bord √©nerg√©tique': window.i18n.t('image.tableau-bord-energetique'),
            '√âcran d\'accueil': window.i18n.t('image.ecran-accueil'),
            'Liste des Gammes': window.i18n.t('image.liste-gammes'),
            'Validation √©tapes': window.i18n.t('image.validation-etapes'),
            'Interface Parametres': window.i18n.t('image.interface-parametres'),
            'Supervision soudures': window.i18n.t('image.supervision-soudures'),
            'Historique param√®tres': window.i18n.t('image.historique-parametres'),
            'Cam√©ra de d√©tection': window.i18n.t('image.camera-detection')
          };
          
          const translatedTitle = titleMapping[img.title] || img.title;
          const safeTitle = (translatedTitle || '').replace(/'/g, "\\'");
          return `
          <div class="relative group cursor-pointer" onclick="openImageModal('${img.src}', '${safeTitle}')">
            <img src="${img.src}" alt="${translatedTitle || 'Capture ' + (i+1)}" 
                 class="w-full h-48 object-cover rounded-xl border border-white/10 transition-transform hover:scale-105" />
            ${translatedTitle ? `<p class="text-xs text-slate-400 mt-1">${translatedTitle}</p>` : ''}
          </div>
        `}).join('');
      }

      if (!p.media || p.media.length === 0) {
        drawerMediaSection.classList.add('hidden');
      } else {
        drawerMediaSection.classList.remove('hidden');
        drawerMedia.innerHTML = p.media.map((m,i)=>{
          if (m.type === 'chart') return `<canvas data-chart-id="${p.id}-media-${i}" height="140" class="rounded-xl bg-ink-700 p-2 border border-white/10"></canvas>`;
          return '';
        }).join('');

        p.media?.forEach((m,i)=>{
          if (m.type === 'chart') {
            setTimeout(() => {
              const canvas = document.querySelector(`canvas[data-chart-id="${p.id}-media-${i}"]`);
              if (canvas) {
                const ctx = canvas.getContext('2d');
                new Chart(ctx, {
                  type: 'line',
                  data: {
                    labels: Array.from({length: 12}, (_,k)=>`${k}:00`),
                    datasets: [{
                      label: m.label || 'S√©rie',
                      data: Array.from({length: 12}, ()=>Math.round(Math.random()*100)),
                      fill: false,
                      borderColor: '#10b981',
                      backgroundColor: '#10b981'
                    }]
                  },
                  options: { responsive: true, maintainAspectRatio: false }
                });
              }
            }, 100);
          }
        });
      }

      drawer.classList.remove('hidden');
    }

    function closeDrawer() { 
      drawer.classList.add('hidden'); 
    }

    // --- Gestion du modal image ---
    function openImageModal(src, title) {
      const modal = document.getElementById('imageModal');
      const img = document.getElementById('modalImage');
      const titleEl = document.getElementById('modalImageTitle');
      img.src = src;
      titleEl.textContent = title || '';
      modal.classList.remove('hidden');
    }

    function closeImageModal() {
      document.getElementById('imageModal').classList.add('hidden');
    }

    // --- Rendu des cartes ---
    function renderCards(list) {
      grid.innerHTML = '';
      const currentLang = window.i18n.getLang();
      
      list.forEach(p => {
        const el = document.createElement('article');
        el.className = 'card relative rounded-2xl p-4 shadow-glass hover:shadow-2xl hover:shadow-black/30 transition-shadow duration-300';

        const isEnCours = (p.status||'livre') === 'en_cours';
        const statusEmoji = isEnCours ? 'üü°' : 'üü¢';
        const statusLabel = isEnCours ? window.i18n.t('status.inProgress') : window.i18n.t('status.completed');

        // Utiliser les traductions si disponibles, sinon fallback sur les donn√©es originales
        const projectTitle = window.i18n.t(`project.${p.id}.title`) || p.title;
        const projectObjective = window.i18n.t(`project.${p.id}.objective`) || p.objective;
        const projectRealShort = window.i18n.t(`project.${p.id}.real_short`) || p.real_short || p.real.slice(0,3);
        const projectResultsShort = window.i18n.t(`project.${p.id}.results_short`) || p.results_short || p.results.slice(0,3);
        
        // Mapping des zones pour les cartes
        const areaMapping = {
          'ATS ¬∑ Supervision ¬∑ SQL': window.i18n.t('area.ats-supervision-sql'),
          'ATS ¬∑ RFID ¬∑ S√©curit√©': window.i18n.t('area.ats-rfid-securite'),
          'ATR ¬∑ RFID ¬∑ S√©curit√©': window.i18n.t('area.atr-rfid-securite'),
          'ATS ¬∑ ATR ¬∑ Web ¬∑ DataViz': window.i18n.t('area.ats-atr-web-dataviz'),
          'Android ¬∑ API ¬∑ UX': window.i18n.t('area.android-api-ux'),
          'ATR ¬∑ Supervision ¬∑ Qualit√©': window.i18n.t('area.atr-supervision-qualite'),
          'ATR ¬∑ Vision ¬∑ Automatisme': window.i18n.t('area.atr-vision-automatisme')
        };
        const translatedArea = areaMapping[p.area] || p.area;

        el.innerHTML = `
          <div class="flex items-start gap-3">
            <div class="h-10 w-10 rounded-xl bg-brand-500/15 text-brand-400 grid place-items-center">üìå</div>
            <div class="flex-1">
              <div class="flex items-center justify-between gap-3">
                <h3 class="text-base font-semibold leading-tight flex items-center gap-2">
                  ${projectTitle}
                  <span class="chip text-[10px] px-2 py-0.5 rounded-full bg-white/5">${statusEmoji} ${statusLabel}</span>
                </h3>
                <button class="text-xs px-2 py-1 rounded-lg bg-white/10 hover:bg-white/20" data-open>${window.i18n.t('btn.view')}</button>
              </div>
              <p class="text-xs text-slate-400 mt-0.5">${translatedArea}</p>
              <div class="mt-4 mb-3 p-3 rounded-lg bg-gradient-to-r from-brand-500/10 to-brand-600/5 border-l-2 border-brand-500">
                <p class="text-xs uppercase tracking-wide text-brand-400 font-semibold mb-1">${window.i18n.t('card.objective')}</p>
                <p class="text-sm text-slate-100 leading-relaxed">${projectObjective}</p>
              </div>
              <div class="flex flex-wrap gap-1 mt-3">${p.skills.slice(0,5).map(chip).join('')}</div>
              <div class="mt-4 grid grid-cols-2 gap-2">
                <div class="rounded-xl bg-ink-700/60 border border-white/10 p-3">
                  <p class="text-[10px] text-slate-400">${window.i18n.t('card.realization')}</p>
                  <ul class="mt-1 text-sm list-disc list-inside marker:text-brand-500 space-y-1">
                    ${projectRealShort.map(x=>`<li>${x}</li>`).join('')}
                  </ul>
                </div>
                <div class="rounded-xl bg-ink-700/60 border border-white/10 p-3">
                  <p class="text-[10px] text-slate-400">${window.i18n.t('card.results')}</p>
                  <ul class="mt-1 text-sm list-disc list-inside marker:text-emerald-400 space-y-1">
                    ${projectResultsShort.map(x=>`<li>${x}</li>`).join('')}
                  </ul>
                </div>
              </div>
            </div>
          </div>
        `;

        el.querySelectorAll('[data-open]').forEach(b=> b.addEventListener('click', ()=> openDrawer(p)) );
        grid.appendChild(el);
      });
    }

    // --- Filtrage ---
    function renderFiltered(){
      let list = DATA;
      if (activeFilter !== 'all') list = list.filter(p=>p.filters.includes(activeFilter));
      if (activeStatus !== 'all') list = list.filter(p=>(p.status||'livre')===activeStatus);
      renderCards(list);
      updateKPIs(list);
    }

    // --- KPIs ---
    function updateKPIs(list){
      const projects = list.length;
      const results = list.reduce((a,p)=> a + (p.results?.length||0), 0);
      const skills = uniq(list.flatMap(p=>p.skills)).length;
      document.getElementById('kpiProjects').textContent = projects;
      document.getElementById('kpiResults').textContent = results;
      document.getElementById('kpiSkills').textContent = skills;
    }

    // --- Lexique des comp√©tences ---
    const skillsLexicon = {
      fr: {
      "SQL Server": "Syst√®me de gestion de base de donn√©es relationnelle Microsoft pour stocker, g√©rer et exploiter les donn√©es de production.",
      "Automatisme": "Programmation et configuration d'automates industriels (PLC) pour piloter les machines et processus de production.",
      "RFID": "Technologie de Radio-Identification pour l'identification automatique et la tra√ßabilit√© par badges sans contact.",
      "Cimplicity": "Logiciel de supervision industrielle GE Digital pour la visualisation et le contr√¥le des processus en temps r√©el.",
      "Basic Script": "Langage de script int√©gr√© √† Cimplicity pour automatiser les t√¢ches et cr√©er des logiques personnalis√©es.",
      "Gestion projet": "Coordination, planification et suivi de projets industriels du cadrage √† la livraison.",
      "C#": "Langage de programmation orient√© objet Microsoft pour d√©velopper des applications desktop Windows.",
      "OPC": "Standard de communication industrielle (OPC DA/UA) pour √©changer des donn√©es entre automates et logiciels.",
      "S7": "Gamme d'automates programmables Siemens (S7-300, S7-1200, S7-1500) et langage de programmation associ√©.",
      "HTML5": "Langage de balisage web moderne pour cr√©er des interfaces utilisateur interactives et responsives.",
      "Tailwind CSS": "Framework CSS utilitaire pour concevoir rapidement des interfaces web modernes et √©l√©gantes.",
      "Chart.js": "Biblioth√®que JavaScript open-source pour cr√©er des graphiques et visualisations de donn√©es interactifs.",
      "Communication industrielle": "Mise en place et exploitation de r√©seaux industriels (Profinet, Ethernet/IP, Modbus...).",
      "Android": "D√©veloppement d'applications mobiles natives pour la plateforme Android.",
      "Kotlin": "Langage de programmation moderne et officiel pour le d√©veloppement d'applications Android.",
      "Retrofit": "Biblioth√®que Android pour g√©rer les communications HTTP avec des API REST de mani√®re simplifi√©e.",
      "API REST": "Conception et utilisation d'interfaces de programmation web pour l'√©change de donn√©es entre syst√®mes.",
      "Architecture client/serveur": "Conception d'applications distribu√©es avec s√©paration des responsabilit√©s entre client et serveur.",
      "UI/UX": "Design d'interfaces utilisateur intuitives et conception d'exp√©riences utilisateur optimales.",
      "R√©seau industriel": "Configuration et exploitation de r√©seaux d√©di√©s √† l'automatisme (Profinet, Ethernet industriel).",
      "Analyse de donn√©es": "Exploitation et interpr√©tation de donn√©es industrielles pour optimiser les processus.",
      "Vision industrielle": "Syst√®mes de contr√¥le qualit√© par cam√©ra pour la d√©tection et l'inspection automatis√©e.",
      "IFM Vision Assistant": "Logiciel et syst√®me de vision industrielle IFM pour le param√©trage de cam√©ras intelligentes.",
      "Profinet": "Protocole de communication industriel Siemens bas√© sur Ethernet pour l'automatisation temps r√©el.",
      "Statistiques": "Collecte, analyse et exploitation de donn√©es chiffr√©es pour le pilotage et l'am√©lioration continue.",
      "D√©ploiement multi-site": "D√©ploiement et harmonisation de solutions techniques sur plusieurs sites de production.",
      "Impression √©tiquettes": "Gestion et automatisation de l'impression d'√©tiquettes de tra√ßabilit√©.",
      "C# Desktop": "D√©veloppement d'applications Windows desktop avec l'environnement .NET et C#."
      },
      it: {
        "SQL Server": "Sistema di gestione di database relazionali Microsoft per memorizzare, gestire e sfruttare i dati di produzione.",
        "Automatisme": "Programmazione e configurazione di automi industriali (PLC) per pilotare macchine e processi di produzione.",
        "RFID": "Tecnologia di Radio-Identificazione per l'identificazione automatica e la tracciabilit√† tramite badge senza contatto.",
        "Cimplicity": "Software di supervisione industriale GE Digital per la visualizzazione e il controllo dei processi in tempo reale.",
        "Basic Script": "Linguaggio di script integrato in Cimplicity per automatizzare le attivit√† e creare logiche personalizzate.",
        "Gestion projet": "Coordinamento, pianificazione e monitoraggio di progetti industriali dalla definizione alla consegna.",
        "C#": "Linguaggio di programmazione orientato agli oggetti Microsoft per sviluppare applicazioni desktop Windows.",
        "OPC": "Standard di comunicazione industriale (OPC DA/UA) per scambiare dati tra automi e software.",
        "S7": "Gamma di automi programmabili Siemens (S7-300, S7-1200, S7-1500) e linguaggio di programmazione associato.",
        "HTML5": "Linguaggio di markup web moderno per creare interfacce utente interattive e responsive.",
        "Tailwind CSS": "Framework CSS utility per progettare rapidamente interfacce web moderne ed eleganti.",
        "Chart.js": "Libreria JavaScript open-source per creare grafici e visualizzazioni di dati interattivi.",
        "Communication industrielle": "Implementazione e sfruttamento di reti industriali (Profinet, Ethernet/IP, Modbus...).",
        "Android": "Sviluppo di applicazioni mobili native per la piattaforma Android.",
        "Kotlin": "Linguaggio di programmazione moderno e ufficiale per lo sviluppo di applicazioni Android.",
        "Retrofit": "Libreria Android per gestire le comunicazioni HTTP con API REST in modo semplificato.",
        "API REST": "Progettazione e utilizzo di interfacce di programmazione web per lo scambio di dati tra sistemi.",
        "Architecture client/serveur": "Progettazione di applicazioni distribuite con separazione delle responsabilit√† tra client e server.",
        "UI/UX": "Design di interfacce utente intuitive e progettazione di esperienze utente ottimali.",
        "R√©seau industriel": "Configurazione e sfruttamento di reti dedicate all'automazione (Profinet, Ethernet industriale).",
        "Analyse de donn√©es": "Sfruttamento e interpretazione di dati industriali per ottimizzare i processi.",
        "Vision industrielle": "Sistemi di controllo qualit√† tramite camera per il rilevamento e l'ispezione automatizzata.",
        "IFM Vision Assistant": "Software e sistema di visione industriale IFM per la configurazione di camere intelligenti.",
        "Profinet": "Protocollo di comunicazione industriale Siemens basato su Ethernet per l'automazione in tempo reale.",
        "Statistiques": "Raccolta, analisi e sfruttamento di dati numerici per il pilotaggio e il miglioramento continuo.",
        "D√©ploiement multi-site": "Implementazione e armonizzazione di soluzioni tecniche su pi√π siti di produzione.",
        "Impression √©tiquettes": "Gestione e automazione della stampa di etichette di tracciabilit√†.",
        "C# Desktop": "Sviluppo di applicazioni Windows desktop con l'ambiente .NET e C#."
      }
    };

    // --- Affichage de toutes les comp√©tences ---
    function showAllSkills() {
      const allSkills = uniq(DATA.flatMap(p=>p.skills)).sort();
      
      drawerTitle.textContent = window.i18n.t('skills.lexicon.title');
      drawerArea.textContent = `${allSkills.length} ${window.i18n.t('skills.lexicon.subtitle')}`;
      
      // Cr√©er les bulles cliquables DANS l'objectif (en haut)
      const chipsHTML = allSkills.map(skill => {
        const safeId = skill.replace(/[^a-zA-Z0-9]/g, '_');
        return `<span class="chip text-xs px-3 py-1 rounded-full bg-white/10 hover:bg-brand-500/30 cursor-pointer transition-colors" onclick="scrollToSkill('${safeId}')">${skill}</span>`;
      }).join('');
      
      drawerObjective.innerHTML = `
        <p class="text-slate-200 mb-4">${window.i18n.t('skills.lexicon.description')}</p>
        <div class="mt-4 p-3 rounded-lg bg-slate-800/60 border border-slate-600/30">
          <p class="text-xs uppercase tracking-wide text-slate-400 mb-3">${window.i18n.t('skills.lexicon.clickHint')}</p>
          <div class="flex flex-wrap gap-2">${chipsHTML}</div>
        </div>
      `;
      
      // Cr√©er le lexique avec IDs dans REALISATION
      const currentLang = window.i18n.getLang();
      const lexiqueHTML = allSkills.map(skill => {
        const description = skillsLexicon[currentLang]?.[skill] || window.i18n.t('skills.lexicon.defaultDesc');
        const safeId = skill.replace(/[^a-zA-Z0-9]/g, '_');
        return `
          <div id="skill-${safeId}" class="skill-card mb-4 p-4 rounded-xl bg-ink-700/60 border border-white/10 hover:border-brand-500/30 transition-all">
            <h4 class="text-base font-semibold text-brand-400 mb-2 flex items-center gap-2">
              <span class="text-brand-500">‚ñ∏</span> ${skill}
            </h4>
            <p class="text-sm text-slate-300 leading-relaxed">${description}</p>
          </div>
        `;
      }).join('');
      
      drawerReal.innerHTML = lexiqueHTML;
      drawerResults.innerHTML = '';
      drawerSkillsSection.classList.add('hidden');
      drawerMediaSection.classList.add('hidden');
      drawerImagesSection.classList.add('hidden');
      
      drawer.classList.remove('hidden');
    }
    
    // Fonction pour scroller vers une comp√©tence et la mettre en surbrillance
    function scrollToSkill(skillId) {
      const element = document.getElementById('skill-' + skillId);
      if (element) {
        // Enlever le highlight de tous les √©l√©ments
        document.querySelectorAll('.skill-card').forEach(card => {
          card.classList.remove('bg-brand-500/20', 'border-brand-500', 'scale-105');
        });
        
        // Scroller vers l'√©l√©ment
        element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
        // Ajouter le highlight
        element.classList.add('bg-brand-500/20', 'border-brand-500', 'scale-105');
        
        // Retirer le highlight apr√®s 2 secondes
        setTimeout(() => {
          element.classList.remove('bg-brand-500/20', 'border-brand-500', 'scale-105');
        }, 2000);
      }
    }

    // --- Initialisation ---
    document.addEventListener('DOMContentLoaded', async function() {
      // Initialiser le composant de commentaires V2
      commentsComponent = new CommentsComponent('commentsContainer', {
        apiBaseUrl: '/api/commentsv2',
        currentUser: window.__SESSION_USER || null,
        limit: 50
      });
      
      // Rendu initial
      renderCards(DATA);
      updateKPIs(DATA);
      document.getElementById('lastUpdate').textContent = new Date().toLocaleString('fr-FR');

      // Event listeners pour les filtres
      const filterButtons = document.querySelectorAll('[data-filter]');
      const statusButtons = document.querySelectorAll('[data-status]');

      filterButtons.forEach(btn => btn.addEventListener('click', () => {
        activeFilter = btn.dataset.filter;
        filterButtons.forEach(b=> b.classList.remove('bg-white/20'));
        btn.classList.add('bg-white/20');
        renderFiltered();
      }));

      statusButtons.forEach(btn => btn.addEventListener('click', () => {
        activeStatus = btn.dataset.status;
        statusButtons.forEach(b=> b.classList.remove('bg-white/20'));
        btn.classList.add('bg-white/20');
        renderFiltered();
      }));

      // Event listeners pour le drawer
      drawer.addEventListener('click', (e)=>{ if (e.target.dataset.close !== undefined) closeDrawer(); });
      window.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') closeDrawer(); });

      // Event listener pour le KPI comp√©tences
      document.getElementById('kpiSkillsCard').addEventListener('click', showAllSkills);

      // Event listeners pour les boutons
      btnShare.addEventListener('click', () => {
        const currentUrl = window.location.href;
        const shareText = window.i18n.t('app.title') + ' - ' + window.i18n.t('app.subtitle');
        
        // Cr√©er un menu de partage
        const shareMenu = document.createElement('div');
        shareMenu.className = 'fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm';
        shareMenu.innerHTML = `
          <div class="bg-ink-800 border border-white/10 rounded-2xl p-6 max-w-md w-full">
            <h3 class="text-lg font-semibold mb-4" data-i18n="share.title">Partager le dashboard</h3>
            <div class="space-y-3">
              <button class="w-full p-3 rounded-lg bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-3" onclick="shareViaTeams()">
                <span class="text-xl">üíº</span>
                <span data-i18n="share.teams">Partager via Microsoft Teams</span>
              </button>
              <button class="w-full p-3 rounded-lg bg-blue-500 hover:bg-blue-600 text-white flex items-center gap-3" onclick="shareViaOutlook()">
                <span class="text-xl">üìß</span>
                <span data-i18n="share.outlook">Partager via Outlook</span>
              </button>
              <button class="w-full p-3 rounded-lg bg-white/10 hover:bg-white/20 text-white flex items-center gap-3" onclick="copyToClipboard()">
                <span class="text-xl">üìã</span>
                <span data-i18n="share.copy">Copier le lien</span>
              </button>
            </div>
            <button class="mt-4 w-full p-2 rounded-lg bg-white/5 hover:bg-white/10 text-slate-400" onclick="closeShareMenu()" data-i18n="btn.close">Fermer</button>
          </div>
        `;
        
        document.body.appendChild(shareMenu);
        
        // Appliquer les traductions au menu
        window.requestAnimationFrame(() => {
          const currentLang = window.i18n.getLang();
          shareMenu.querySelectorAll("[data-i18n]").forEach(el => {
            const key = el.getAttribute("data-i18n");
            const translation = window.i18n.t(key);
            if (translation !== key) el.textContent = translation;
          });
        });
        
        // Fermer en cliquant √† l'ext√©rieur
        shareMenu.addEventListener('click', (e) => {
          if (e.target === shareMenu) closeShareMenu();
        });
        
        // Fonction pour g√©n√©rer un message dynamique bas√© sur les projets
        const generateDynamicMessage = (currentLang) => {
          const currentUrl = window.location.href;
          const projects = window.DATA || [];
          
          // Corriger les filtres selon les vraies valeurs des projets
          const activeProjects = projects.filter(p => p.status === 'en_cours').length;
          const completedProjects = projects.filter(p => p.status === 'livre').length;
          
          // Compter les projets par zone (selon les filtres)
          const atsProjects = projects.filter(p => p.filters && p.filters.includes('ATS')).length;
          const atrProjects = projects.filter(p => p.filters && p.filters.includes('ATR')).length;
          const bothProjects = projects.filter(p => p.filters && p.filters.includes('ATS') && p.filters.includes('ATR')).length;
          
          const messages = {
            fr: `Bonjour,

Je souhaitais partager avec vous ma synth√®se interactive des projets 2025.

üìä Dashboard Projets 2025 - Synth√®se ATS/ATR
${currentUrl}

Cette synth√®se pr√©sente l'ensemble des projets techniques r√©alis√©s cette ann√©e, avec :
‚Ä¢ ${projects.length} projets au total (${activeProjects} en cours, ${completedProjects} termin√©s)
‚Ä¢ ${atsProjects} projets ATS, ${atrProjects} projets ATR, ${bothProjects} projets mixtes
‚Ä¢ D√©tails techniques et r√©sultats obtenus
‚Ä¢ Comp√©tences mobilis√©es et technologies utilis√©es
‚Ä¢ Captures d'√©cran et d√©monstrations

Le dashboard est interactif et permet de naviguer dans chaque projet pour d√©couvrir les r√©alisations, objectifs et impacts business.

N'h√©sitez pas √† me faire vos retours si vous souhaitez plus de d√©tails sur un projet sp√©cifique.

Cordialement,
Nathan Villaume`,
            it: `Buongiorno,

Desideravo condividere con voi la mia sintesi interattiva dei progetti 2025.

üìä Dashboard Progetti 2025 - Sintesi ATS/ATR
${currentUrl}

Questa sintesi presenta l'insieme dei progetti tecnici realizzati quest'anno, con :
‚Ä¢ ${projects.length} progetti totali (${activeProjects} in corso, ${completedProjects} completati)
‚Ä¢ ${atsProjects} progetti ATS, ${atrProjects} progetti ATR, ${bothProjects} progetti misti
‚Ä¢ Dettagli tecnici e risultati ottenuti
‚Ä¢ Competenze mobilitate e tecnologie utilizzate
‚Ä¢ Screenshot e dimostrazioni

La dashboard √® interattiva e permette di navigare in ogni progetto per scoprire le realizzazioni, obiettivi e impatti business.

Non esitate a farmi i vostri feedback se desiderate maggiori dettagli su un progetto specifico.

Cordiali saluti,
Nathan Villaume`
          };
          
          return messages[currentLang] || messages.fr;
        };

        // Fonctions de partage
        window.shareViaTeams = () => {
          console.log('shareViaTeams appel√©');
          
          const currentLang = window.i18n.getLang();
          const professionalMessage = generateDynamicMessage(currentLang);

          // Fonction de copie avec fallback
          const copyToClipboard = (text) => {
            // M√©thode moderne (n√©cessite HTTPS)
            if (navigator.clipboard && navigator.clipboard.writeText) {
              return navigator.clipboard.writeText(text);
            }
            
            // M√©thode de fallback (fonctionne en HTTP)
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
              const successful = document.execCommand('copy');
              document.body.removeChild(textArea);
              return successful ? Promise.resolve() : Promise.reject(new Error('execCommand failed'));
            } catch (err) {
              document.body.removeChild(textArea);
              return Promise.reject(err);
            }
          };

          // Copier le message dans le presse-papiers
          copyToClipboard(professionalMessage).then(() => {
            console.log('Message copi√© avec succ√®s');
            
            // Messages de notification selon la langue
            const notificationMessages = {
              fr: {
                title: 'Message copi√© !',
                subtitle: 'Collez (Ctrl+V) dans Teams'
              },
              it: {
                title: 'Messaggio copiato!',
                subtitle: 'Incolla (Ctrl+V) in Teams'
              }
            };
            
            const notif = notificationMessages[currentLang] || notificationMessages.fr;
            
            // Afficher une notification
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 z-[100] bg-blue-600 text-white p-4 rounded-lg shadow-lg max-w-sm';
            notification.innerHTML = `
              <div class="flex items-center gap-3">
                <span class="text-2xl">‚úÖ</span>
                <div>
                  <p class="font-semibold">${notif.title}</p>
                  <p class="text-sm opacity-90">${notif.subtitle}</p>
                </div>
              </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
              if (document.body.contains(notification)) {
                document.body.removeChild(notification);
              }
            }, 4000);
            
            // Essayer d'ouvrir Teams (avec confirmation si n√©cessaire)
            try {
              window.location.href = 'msteams:';
              console.log('Tentative d\'ouverture Teams');
            } catch (e) {
              console.log('Erreur ouverture Teams:', e);
            }
            
          }).catch(err => {
            console.error('Erreur copie presse-papiers:', err);
            
            // Messages d'erreur selon la langue
            const errorMessages = {
              fr: {
                title: 'Erreur',
                subtitle: 'Impossible de copier le message'
              },
              it: {
                title: 'Errore',
                subtitle: 'Impossibile copiare il messaggio'
              }
            };
            
            const errorNotif = errorMessages[currentLang] || errorMessages.fr;
            
            // Fallback: notification d'erreur
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 z-[100] bg-red-600 text-white p-4 rounded-lg shadow-lg max-w-sm';
            notification.innerHTML = `
              <div class="flex items-center gap-3">
                <span class="text-2xl">‚ùå</span>
                <div>
                  <p class="font-semibold">${errorNotif.title}</p>
                  <p class="text-sm opacity-90">${errorNotif.subtitle}</p>
                </div>
              </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
              if (document.body.contains(notification)) {
                document.body.removeChild(notification);
              }
            }, 3000);
          });
          
          window.closeShareMenu();
        };
        
        window.shareViaOutlook = () => {
          const currentLang = window.i18n.getLang();
          const professionalMessage = generateDynamicMessage(currentLang);
          
          // Sujets selon la langue
          const subjects = {
            fr: 'Dashboard Projets 2025 - Synth√®se ATS/ATR',
            it: 'Dashboard Progetti 2025 - Sintesi ATS/ATR'
          };
          
          const subject = subjects[currentLang] || subjects.fr;
          const mailtoUrl = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(professionalMessage)}`;
          
          // Cr√©er un lien invisible pour d√©clencher l'ouverture
          const link = document.createElement('a');
          link.href = mailtoUrl;
          link.style.display = 'none';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          
          window.closeShareMenu();
        };
        
        window.copyToClipboard = async () => {
          const currentUrl = window.location.href;
          
          // Fonction de copie avec fallback
          const copyText = (text) => {
            // M√©thode moderne (n√©cessite HTTPS)
            if (navigator.clipboard && navigator.clipboard.writeText) {
              return navigator.clipboard.writeText(text);
            }
            
            // M√©thode de fallback (fonctionne en HTTP)
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
              const successful = document.execCommand('copy');
              document.body.removeChild(textArea);
              return successful ? Promise.resolve() : Promise.reject(new Error('execCommand failed'));
            } catch (err) {
              document.body.removeChild(textArea);
              return Promise.reject(err);
            }
          };
          
          try {
            await copyText(currentUrl);
            // Afficher une notification de succ√®s
            const btn = shareMenu.querySelector('[onclick="copyToClipboard()"]');
            const originalText = btn.textContent;
            btn.textContent = '‚úÖ Copi√© !';
            btn.classList.add('bg-green-500/20', 'text-green-400');
            setTimeout(() => {
              btn.textContent = originalText;
              btn.classList.remove('bg-green-500/20', 'text-green-400');
            }, 2000);
          } catch (err) {
            console.error('Erreur lors de la copie:', err);
            // Afficher une notification d'erreur
            const btn = shareMenu.querySelector('[onclick="copyToClipboard()"]');
            const originalText = btn.textContent;
            btn.textContent = '‚ùå Erreur';
            btn.classList.add('bg-red-500/20', 'text-red-400');
            setTimeout(() => {
              btn.textContent = originalText;
              btn.classList.remove('bg-red-500/20', 'text-red-400');
            }, 2000);
          }
        };
        
        window.closeShareMenu = () => {
          document.body.removeChild(shareMenu);
        };
      });

      console.info('‚úÖ Dashboard initialis√© avec', DATA.length, 'projets');
      console.info('‚úÖ Syst√®me de commentaires V2 initialis√© (JSONL multi-utilisateurs)');
      console.info('‚úÖ Syst√®me i18n initialis√© avec langue:', window.i18n.getLang());
    });

    // Exposer les fonctions globalement pour l'i18n
    window.renderCards = renderCards;
    window.showAllSkills = showAllSkills;
    window.DATA = DATA;
    window.currentProjectId = currentProjectId;
    </script>
</body>
</html>
