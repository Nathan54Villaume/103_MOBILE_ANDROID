<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Menu Settings Unifi√©</title>
    <style>
        body { 
            background: #0f172a; 
            color: white; 
            font-family: system-ui; 
            padding: 20px; 
            margin: 0;
        }
        .test-area {
            width: 400px;
            height: 200px;
            background: #1e293b;
            border: 2px solid #4b5563;
            margin: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
        }
        .btn {
            background: #6366f1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px;
        }
        .btn:hover {
            background: #4f46e5;
        }
        #info {
            background: #111827;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Menu Settings Unifi√©</h1>
    <p>Test du menu de r√©glages unifi√© (nouveau syst√®me uniquement)</p>
    
    <div class="test-area" id="testArea">
        Clic droit ici pour tester le menu contextuel !
    </div>
    
    <button onclick="testSettingsMenu()" class="btn">
        üîß Tester le menu de r√©glages
    </button>
    
    <button onclick="testChartCreation()" class="btn">
        üìä Cr√©er un chart de test
    </button>
    
    <button onclick="clearLog()" class="btn">
        üóëÔ∏è Vider les logs
    </button>
    
    <div id="info"></div>
    
    <!-- Inclure les d√©pendances n√©cessaires -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
    
    <script type="module">
        // Import des modules
        import { initChart, getChart } from './charts/index.js';
        import { initChartSettings } from './js/chart-settings.js';
        
        const info = document.getElementById('info');
        let testChartInstance = null;
        
        function log(message) {
            const div = document.createElement('div');
            div.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            info.appendChild(div);
            info.scrollTop = info.scrollHeight;
        }
        
        function clearLog() {
            info.innerHTML = '';
        }
        
        // Initialiser le syst√®me de settings
        initChartSettings();
        log('‚úÖ Syst√®me de settings initialis√©');
        
        // Cr√©er un canvas de test
        function createTestCanvas() {
            const canvas = document.createElement('canvas');
            canvas.id = 'test-chart-canvas';
            canvas.width = 400;
            canvas.height = 200;
            canvas.style.border = '1px solid #4b5563';
            canvas.style.borderRadius = '8px';
            return canvas;
        }
        
        // Cr√©er un chart de test
        window.testChartCreation = async function() {
            try {
                log('üìä Cr√©ation d\'un chart de test...');
                
                // Cr√©er le canvas
                const canvas = createTestCanvas();
                document.getElementById('testArea').appendChild(canvas);
                
                // Initialiser le chart
                testChartInstance = initChart('test-chart', 'test-chart-canvas', {
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
                
                if (testChartInstance) {
                    log('‚úÖ Chart de test cr√©√© avec succ√®s');
                    log(`üìã Chart instance: ${JSON.stringify(testChartInstance, null, 2)}`);
                    
                    // Ajouter des donn√©es de test
                    const testData = {
                        datasets: [{
                            label: 'Signal Test 1',
                            data: [
                                { x: Date.now() - 3600000, y: 100 },
                                { x: Date.now() - 1800000, y: 150 },
                                { x: Date.now(), y: 120 }
                            ],
                            borderColor: '#6366f1',
                            backgroundColor: '#6366f120',
                            tension: 0.1
                        }]
                    };
                    
                    testChartInstance.host.setData(testData.datasets);
                    log('üìà Donn√©es de test ajout√©es');
                    
                } else {
                    log('‚ùå √âchec de cr√©ation du chart');
                }
                
            } catch (error) {
                log(`‚ùå Erreur cr√©ation chart: ${error.message}`);
                console.error('Erreur d√©taill√©e:', error);
            }
        };
        
        // Tester le menu de settings
        window.testSettingsMenu = function() {
            if (!testChartInstance) {
                log('‚ö†Ô∏è Cr√©er d\'abord un chart de test');
                return;
            }
            
            try {
                log('üîß Ouverture du menu de settings...');
                
                // Simuler l'√©v√©nement d'ouverture des settings
                const event = new CustomEvent('chart:open-settings', {
                    detail: { chartKey: 'test-chart' }
                });
                document.dispatchEvent(event);
                
                log('‚úÖ √âv√©nement chart:open-settings envoy√©');
                
            } catch (error) {
                log(`‚ùå Erreur ouverture settings: ${error.message}`);
                console.error('Erreur d√©taill√©e:', error);
            }
        };
        
        // Test du menu contextuel
        document.getElementById('testArea').addEventListener('contextmenu', function(e) {
            e.preventDefault();
            log('üñ±Ô∏è Clic droit d√©tect√© - test du menu contextuel');
            
            // Simuler l'ouverture du menu contextuel
            const event = new CustomEvent('chart:contextmenu', {
                detail: { 
                    chartKey: 'test-chart',
                    x: e.clientX,
                    y: e.clientY
                }
            });
            document.dispatchEvent(event);
        });
        
        // √âcouter les √©v√©nements de settings
        document.addEventListener('chart:open-settings', function(e) {
            log(`üì¢ √âv√©nement chart:open-settings re√ßu pour: ${e.detail?.chartKey}`);
        });
        
        document.addEventListener('chart:export', function(e) {
            log(`üì¢ √âv√©nement chart:export re√ßu pour: ${e.detail?.chartKey}`);
        });
        
        document.addEventListener('chart:reset-view', function(e) {
            log(`üì¢ √âv√©nement chart:reset-view re√ßu pour: ${e.detail?.chartKey}`);
        });
        
        log('üöÄ Syst√®me de test initialis√©');
        log('üëâ Instructions:');
        log('   1. Cliquer sur "Cr√©er un chart de test"');
        log('   2. Cliquer sur "Tester le menu de r√©glages"');
        log('   3. Ou clic droit sur la zone bleue pour le menu contextuel');
    </script>
</body>
</html>
