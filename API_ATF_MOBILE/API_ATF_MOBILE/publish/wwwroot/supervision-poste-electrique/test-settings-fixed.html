<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Menu Settings Corrig√©</title>
    <style>
        body { 
            background: #0f172a; 
            color: white; 
            font-family: system-ui; 
            padding: 20px; 
            margin: 0;
        }
        .test-area {
            width: 500px;
            height: 300px;
            background: #1e293b;
            border: 2px solid #4b5563;
            margin: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            position: relative;
        }
        .btn {
            background: #6366f1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px;
        }
        .btn:hover {
            background: #4f46e5;
        }
        .btn-success {
            background: #059669;
        }
        .btn-success:hover {
            background: #047857;
        }
        #info {
            background: #111827;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .test-section {
            background: #1e293b;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #334155;
        }
        .test-section h3 {
            margin-top: 0;
            color: #f1f5f9;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Menu Settings Corrig√©</h1>
    <p>Test complet du menu de r√©glages avec tous les param√®tres fonctionnels</p>
    
    <div class="test-grid">
        <div class="test-section">
            <h3>üìä Chart de Test</h3>
            <div class="test-area" id="testArea">
                <div style="text-align: center;">
                    <div>üìà Chart de Test</div>
                    <div style="font-size: 14px; margin-top: 10px; color: #94a3b8;">
                        Clic droit pour menu contextuel<br>
                        Ou bouton "Ouvrir Settings"
                    </div>
                </div>
            </div>
            <button onclick="testSettingsMenu()" class="btn">
                üîß Ouvrir Settings
            </button>
            <button onclick="testChartCreation()" class="btn btn-success">
                üìä Cr√©er Chart
            </button>
        </div>
        
        <div class="test-section">
            <h3>üéõÔ∏è Tests de Param√®tres</h3>
            <button onclick="testBasicSettings()" class="btn">Test Param√®tres de Base</button>
            <button onclick="testAdvancedSettings()" class="btn">Test Param√®tres Avanc√©s</button>
            <button onclick="testAxisSettings()" class="btn">Test Configuration Axes</button>
            <button onclick="testInteractionSettings()" class="btn">Test Interactions</button>
            <button onclick="clearLog()" class="btn">üóëÔ∏è Vider Logs</button>
        </div>
    </div>
    
    <div id="info"></div>
    
    <!-- Inclure les d√©pendances n√©cessaires -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
    
    <script type="module">
        // Import des modules
        import { initChart, getChart } from './charts/index.js';
        import { initChartSettings } from './js/chart-settings.js';
        
        const info = document.getElementById('info');
        let testChartInstance = null;
        
        function log(message) {
            const div = document.createElement('div');
            div.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            info.appendChild(div);
            info.scrollTop = info.scrollHeight;
        }
        
        function clearLog() {
            info.innerHTML = '';
        }
        
        // Initialiser le syst√®me de settings
        initChartSettings();
        log('‚úÖ Syst√®me de settings initialis√©');
        
        // Cr√©er un canvas de test
        function createTestCanvas() {
            const canvas = document.createElement('canvas');
            canvas.id = 'test-chart-canvas';
            canvas.width = 480;
            canvas.height = 280;
            canvas.style.border = '1px solid #4b5563';
            canvas.style.borderRadius = '8px';
            canvas.style.background = '#0f172a';
            return canvas;
        }
        
        // Cr√©er des donn√©es de test r√©alistes
        function generateTestData() {
            const now = Date.now();
            const data1 = [];
            const data2 = [];
            
            for (let i = 0; i < 50; i++) {
                const time = now - (49 - i) * 60000; // 1 point par minute
                const value1 = 100 + Math.sin(i * 0.2) * 30 + Math.random() * 10;
                const value2 = 80 + Math.cos(i * 0.15) * 25 + Math.random() * 8;
                
                data1.push({ x: time, y: value1 });
                data2.push({ x: time, y: value2 });
            }
            
            return {
                datasets: [
                    {
                        label: 'Signal TR1 Puissance',
                        data: data1,
                        borderColor: '#6366f1',
                        backgroundColor: '#6366f120',
                        tension: 0.1,
                        borderWidth: 2
                    },
                    {
                        label: 'Signal TR2 Puissance',
                        data: data2,
                        borderColor: '#f59e0b',
                        backgroundColor: '#f59e0b20',
                        tension: 0.1,
                        borderWidth: 2
                    }
                ]
            };
        }
        
        // Cr√©er un chart de test
        window.testChartCreation = async function() {
            try {
                log('üìä Cr√©ation d\'un chart de test...');
                
                // Cr√©er le canvas
                const canvas = createTestCanvas();
                document.getElementById('testArea').innerHTML = '';
                document.getElementById('testArea').appendChild(canvas);
                
                // Initialiser le chart
                testChartInstance = initChart('test-chart', 'test-chart-canvas', {
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                labels: {
                                    color: '#e2e8f0'
                                }
                            }
                        },
                        scales: {
                            x: {
                                type: 'time',
                                time: {
                                    tooltipFormat: 'HH:mm:ss'
                                },
                                ticks: {
                                    color: '#e2e8f0'
                                },
                                grid: {
                                    color: 'rgba(148,163,184,0.15)'
                                }
                            },
                            y: {
                                ticks: {
                                    color: '#e2e8f0'
                                },
                                grid: {
                                    color: 'rgba(148,163,184,0.15)'
                                }
                            }
                        }
                    }
                });
                
                if (testChartInstance) {
                    log('‚úÖ Chart de test cr√©√© avec succ√®s');
                    
                    // Ajouter des donn√©es de test
                    const testData = generateTestData();
                    testChartInstance.host.setData(testData.datasets);
                    log('üìà Donn√©es de test ajout√©es (2 signaux, 50 points chacun)');
                    
                } else {
                    log('‚ùå √âchec de cr√©ation du chart');
                }
                
            } catch (error) {
                log(`‚ùå Erreur cr√©ation chart: ${error.message}`);
                console.error('Erreur d√©taill√©e:', error);
            }
        };
        
        // Tester le menu de settings
        window.testSettingsMenu = function() {
            if (!testChartInstance) {
                log('‚ö†Ô∏è Cr√©er d\'abord un chart de test');
                return;
            }
            
            try {
                log('üîß Ouverture du menu de settings...');
                
                // Simuler l'√©v√©nement d'ouverture des settings
                const event = new CustomEvent('chart:open-settings', {
                    detail: { chartKey: 'test-chart' }
                });
                document.dispatchEvent(event);
                
                log('‚úÖ √âv√©nement chart:open-settings envoy√©');
                
            } catch (error) {
                log(`‚ùå Erreur ouverture settings: ${error.message}`);
                console.error('Erreur d√©taill√©e:', error);
            }
        };
        
        // Tests sp√©cifiques des param√®tres
        window.testBasicSettings = function() {
            log('üß™ Test des param√®tres de base...');
            log('   - Grille: doit s\'activer/d√©sactiver');
            log('   - L√©gende: doit s\'afficher/masquer');
            log('   - √âpaisseur ligne: doit changer (1px √† 4px)');
            log('   - Base de temps: doit changer l\'affichage temporel');
        };
        
        window.testAdvancedSettings = function() {
            log('üß™ Test des param√®tres avanc√©s...');
            log('   - Tooltips: doit s\'activer/d√©sactiver');
            log('   - Crosshair: doit s\'afficher/masquer');
            log('   - Lissage courbes: doit changer la tension (0 √† 0.5)');
            log('   - Transparence: doit changer l\'alpha (0% √† 100%)');
        };
        
        window.testAxisSettings = function() {
            log('üß™ Test de la configuration des axes...');
            log('   - Y commence √† 0: doit forcer min=0');
            log('   - √âchelle Y auto: doit supprimer min/max');
            log('   - Format heure X: doit changer HH:mm, HH:mm:ss, dd/MM HH:mm');
            log('   - Unit√© Y: doit changer l\'affichage des unit√©s');
        };
        
        window.testInteractionSettings = function() {
            log('üß™ Test des interactions...');
            log('   - Zoom molette: doit s\'activer/d√©sactiver');
            log('   - Panoramique: doit s\'activer/d√©sactiver');
            log('   - Sensibilit√© zoom: doit changer la vitesse (0.1x √† 2.0x)');
            log('   - Actualisation: doit changer la fr√©quence (1s √† 60s)');
        };
        
        // Test du menu contextuel
        document.getElementById('testArea').addEventListener('contextmenu', function(e) {
            e.preventDefault();
            log('üñ±Ô∏è Clic droit d√©tect√© - test du menu contextuel');
            
            // Simuler l'ouverture du menu contextuel
            const event = new CustomEvent('chart:contextmenu', {
                detail: { 
                    chartKey: 'test-chart',
                    x: e.clientX,
                    y: e.clientY
                }
            });
            document.dispatchEvent(event);
        });
        
        // √âcouter les √©v√©nements de settings
        document.addEventListener('chart:open-settings', function(e) {
            log(`üì¢ √âv√©nement chart:open-settings re√ßu pour: ${e.detail?.chartKey}`);
        });
        
        document.addEventListener('chart:export', function(e) {
            log(`üì¢ √âv√©nement chart:export re√ßu pour: ${e.detail?.chartKey}`);
        });
        
        document.addEventListener('chart:reset-view', function(e) {
            log(`üì¢ √âv√©nement chart:reset-view re√ßu pour: ${e.detail?.chartKey}`);
        });
        
        log('üöÄ Syst√®me de test initialis√©');
        log('üëâ Instructions:');
        log('   1. Cliquer sur "Cr√©er Chart" pour cr√©er un graphique de test');
        log('   2. Cliquer sur "Ouvrir Settings" pour tester le menu');
        log('   3. Tester tous les param√®tres dans le menu');
        log('   4. Utiliser les boutons de test pour v√©rifier chaque section');
    </script>
</body>
</html>
